---
title: "Convert CMMN LimeSurvey file into dataset-all.csv for further processing"
author: "Mike A. Marin"
date: \today
output: pdf_document
toc: TRUE
keep_md: TRUE
keep_tex: FALSE
params:
    test:
        value: FALSE
---
![](pics/by-sa.png)
[This work is licensed under the Creative Commons Attribution-ShareAlike 4.0 International License.](http://creativecommons.org/licenses/by-sa/4.0/)


#Introduction
In the spirit of literate programming and reproducible research, this document describes how the input file  (*in-survey-data-file.csv*) is transformed into the output file (*dataset-all.csv*) that will be used for all the statistics processing.
This file (*CMMN-Convert-File.pdf*) was generated using knitr with R Markdown using the script CMMN-Convert-File.Rmd.
This script should execute after the *copy-and-fix-file.r* has copied the input file coming from LimeSurvey (\textit{results-survey338792.csv}) into the input to this script (*in-survey-data-file.csv*).
Details on the global process are described in the **Instructions(read-me-first).pdf** file, which should be read first.


```{r setup, include=FALSE}
library(car)

knitr::opts_chunk$set(strip.white=TRUE, fig.width=3, fig.height=3, comment='')
                     #,root.dir="E:/PhD/UNISA/work/Experiment design/R/Analysis")
                     #, echo = FALSE)


#set of working directory is done by knitr, and so this does not works:
#setwd("E:\\PhD\\UNISA\\work\\Experiment design\\R\\TestData\\")
getwd()

```
##Input files
The input files required to execute this script are,

File                    |  frame  |  Description
------------------------- | ------- | ----------------------------------------
in-survey-data-file.csv | data | all the survey data (file generated by *copy-and-fix-file.r* script)
in-survey-var-names.csv | nm | file exported from LimeSurvey
in-independent-variables.csv | iv | file describing the independent variables
in-independent-variables-map.csv | iv.map | mapping of independent variables to each of the 30 groups
in-weights.csv | ws | file containing the weights to calculate CMMN Complexity (CC)

##Output files
In addition to the pdf, this script produces several output files that can be used to verify the data manipulation and calculations done by this script.
The generated files are:

File                  |  Description
--------------------- | ------------------------------------------------------
out-comments.txt       | This file contains all the comments (last question in the survey)
out-compare.csv        | pairwise comparison calculations (for testing purposes)
out-perceived.csv      | perceived complexity calculation (for testing purposes)
out-raw-correct.csv    | number of correct answers initial calculations (for testing purposes)
out-correct.csv        | number of correct answers initial calculations (for testing purposes)
out-raw-efficacy.csv   | efficacy initial calculations (for testing purposes)
out-efficacy.csv       | efficacy calculation (for testing and verification purposes)
out-raw-efficiency.csv | efficiency initial calculations (for testing purposes)
out-efficiency.csv     | efficiency calculations (for testing purposes)
dataset-all.csv     | This is the resulting clean data set after all the calculations

All the other scripts will use the *dataset-all.csv* output file.

##Variables
This section describes all the variables from the input files.
The independent variables are stored in two predefined files, and the survey data is extracted from LimeSurvey containing the answers to the survey.

### Independent variables
There are two predefined files containing independent variables.
The fist file (*in-independent-variables.csv*) contains the calculated values of the metrics and the correct answers to the questions for each model.
The file contains one record for each model.
This file has the following variables,

Variable     | Description
------------ | -------------------------------------------------------------
iv.Model           | the model id (m1, m2, m3, m4, m5, m6)
iv.CC              | The calculated value of the CC metric
iv.CL              | The calculated value of the CL metric
iv.CS              | The calculated value of the CS metric
iv.CAS             | The calculated value of the CAS metric
iv.Q1              | Correct answer for question 1 (number)
iv.Q2              | Correct answer for question 2 (1= Yes, 2=No)
iv.Q3              | Correct answer for question 3 (1= Yes, 2=No)
iv.Q4              | Correct answer for question 4 (1= Yes, 2=No)
iv.Q5.R1           | Correct value for check box 1 of question 5 (1=check, 2=empty)
iv.Q5.R2           | Correct value for check box 2 of question 5 (1=check, 2=empty)
iv.Q5.R3           | Correct value for check box 3 of question 5 (1=check, 2=empty)
iv.Q5.R4           | Correct value for check box 4 of question 5 (1=check, 2=empty)
iv.Q5.R5           | Correct value for check box 5 of question 5 (1=check, 2=empty)
iv.Q5.R6           | Correct value for check box 6 of question 5 (1=check, 2=empty)
iv.Q5.Text         | Correct values for question 5 in text
iv.w.CasePlan      | Number of Case plans
iv.w.Stage         | Number of Stages
iv.w.DStage        | Number of Discretionary Stages
iv.w.PlanFrag      | Number of Plan Fragments
iv.w.CFileItem     | Number of Case File Items
iv.w.Task          | Number of Tasks
iv.w.DTask         | Number of Discretionary Tasks
iv.w.NBHTask       | Number of Non-Blocking-Human Tasks
iv.w.ProcTask      | Number of Process Tasks
iv.w.CaseTask      | Number of Case Tasks not in this model
iv.w.CaseTasknim   | Number of Case Task in this model
iv.w.BHTask        | Number of Blocking Human Tasks
iv.w.Event         | Number of Events
iv.w.UserEvent     | Number of User Events
iv.w.TimerEvent    | Number of Timer Events
iv.w.Milestone     | Number of Milestones
iv.w.Connector     | Number of Connectors
iv.w.HumanIcon     | Number of (blocking) human marker (for task and event)
iv.w.CPlanningT    | Number of collapsed planning table
iv.w.EPlanningT    | Number of expanding planning table
iv.w.AComplete     | Number of Auto Complete
iv.w.Collapsed     | Number of Collapsed markers
iv.w.Expanded      | Number of Expanded markers
iv.w.ManualA       | Number of Manual Activation
iv.w.Repetition    | Number of Repetition markers
iv.w.Required      | Number of Required markers
iv.w.EntryCritWC   | Number of Entry Criteria With Connectors
iv.w.EntryCrit     | Number of Entry Criteria without connectors
iv.w.ExitCritWC    | Number of Exit Criteria With Connectors
iv.w.ExitCrit      | Number of Exit Criteria without connectors
iv.w.EntryCritAND  | Number of Entry Criteria AND (multiple connectors)
iv.w.EntryCritOR   | Number of Entry Criteria OR (multiple entry criteria)
iv.w.ExitCritAND   | Number of Exit Criteria AND (multiple connectors)
iv.w.ExitCritOR    | Number of Exit Criteria OR (multiple exit criteria)

Constraints:
Total number of stages = iv.w.Stage + iv.w.DStage
Total number of Tasks = iv.w.Task + iv.w.DTask = iv.w.NBHTask + iv.w.ProcTask + iv.w.CaseTask + iv.w.CaseTasknim + iv.w.BHTask
Total number of events = iv.w.Event = iv.w.UserEvent + iv.w.TimerEvent
Total number of entry criteria = iv.w.EntryCritWC + iv.w.EntryCrit  
Total number of exit criteria = iv.w.ExitCritWC + iv.w.ExitCrit  

The second file (*Surveys.csv*) is a mapping between the independent variables and the SetId variable.
The SetId variable is calculated in LimeSurvey and contains a number from one to 30, that indicates which two models were shown to the subject, in which order they were shown, and which comparison was used.
This file contains 30 records (one for each value of SetId).
The file has the following variables,

Variable     |  Description
------------ | --------------------------------------------------------------------
SetId        | Value of SetId that matches the value generated by LimeSurvey (30 values)
iv.set       | consolidated sets (15 values) 'a vs b' and 'b vs a' are consolidated into 'a vs b'
iv.order     | indicates the order of consolidation 'a vs b' or 'b vs a' (2 values)
iv.A.model   | Number of the first model presented to the subject (model A)
iv.A.mode    | Mode of model (a or b). Both of them are the same, but LimeSurvey required different names
iv.A.name    | Combines the model and the mode (m1a, or m1b, etc.)
iv.A.CC      | Value of calculated metric CC for A.model (comes from in-independent-variables.csv)
iv.A.CL      | Value of calculated metric CL for A.model (comes from in-independent-variables.csv)
iv.A.CS      | Value of calculated metric CS for A.model (comes from in-independent-variables.csv)
iv.A.CAS     | Value of calculated metric CAS for A.model (comes from in-independent-variables.csv)
iv.B.model   | Number of the second model presented to the subject (model B)
iv.B.mode    | Mode of model (a or b). Both of them are the same, but LimeSurvey required different names
iv.B.name    | Combines the model and the mode (m1a, or m1b, etc.)
iv.B.CC      | Value of calculated metric CC for B.model (comes from in-independent-variables.csv)
iv.B.CL      | Value of calculated metric CL for B.model (comes from in-independent-variables.csv)
iv.B.CS      | Value of calculated metric CS for B.model (comes from in-independent-variables.csv)
iv.B.CAS     | Value of calculated metric CAS for B.model (comes from in-independent-variables.csv)
iv.C.obs     | Comparison that was asked to the subject (for example, m1vs2 or m2vs1). 30 comparisons
iv.C.calc    | Maps to recalculated comparison (both m1vs2 and m2vs1 become m2vs1). 15 merged comparisons
iv.C.CC      | Value of calculated comparison (using iv.C.calc) for metric CC (compares A vs B, and B vs A)
iv.C.CL      | Value of calculated comparison (using iv.C.calc) for metric CL (compares A vs B, and B vs A)
iv.C.CS      | Value of calculated comparison (using iv.C.calc) for metric CS (compares A vs B, and B vs A)
iv.C.CAS     | Value of calculated comparison (using iv.C.calc) for metric CAS (compares A vs B, and B vs A)


###Survey variables
The following table shows all the variables in the data frame with descriptions.
This table describes the data collected with the survey and stored in the file (*in-survey-data-file.csv*).

The table needs to be generated every time the survey is deployed and run, because the variable names of group times may change.
*More important, you need to be sure the correct groupTime\<n\> variables are used to calculate efficacy and efficiency (see section on Renaming time variables).*
If get an error from calc.efficiency or calc.efficacy, the first thing to do is check that you are using the right groupTime\<n\> variables.


```{r variables}
#str(params)
nm <- read.csv("in-survey-var-names.csv", header = TRUE, sep = ",", quote = "'\"", 
               na.strings=c("", "\"\""), stringsAsFactors=FALSE)

for(n in sort(names(nm)))
{
  #print(paste("Name:[", n, "]",  sep=""))
  n2 <- strsplit(sub("..",":",n,fixed=TRUE), ":")[[1]]
  print(strtrim(paste(n2[1],": ",trimws(gsub("  "," ",gsub("."," ",
          sub("....."," = ",
          sub("......","",n2[2],fixed=TRUE),fixed=TRUE),fixed=TRUE),fixed=TRUE)),sep=""),
          80))
}
rm(nm, n)

```


##Loading the Survey data
Let now load the data, one file is the actual data from LimeSurvey (data), and the second file is the list and values of the independent variables (iv), and the third file is a map of independent variables to survey data using SetId as a key (iv.map).
```{r load-data}
# Just load the cvs file generated by copy-and-fix-file.r
data <- read.csv("in-survey-data-file.csv", header = TRUE, sep = ",", quote = "'\"",
                 na.strings=c("", "\"\""), stringsAsFactors=FALSE)

# Remove the last dot in variable names, so that "role[A1]"" becomes "role.A1"" (from "role.A1."")
colnames(data) <- gsub("\\.$","", colnames(data)) 

# Load the independent variables
iv <- read.csv("in-independent-variables.csv", header = TRUE, sep = ",", quote = "'\"",
               na.strings=c("", "\"\""), stringsAsFactors=FALSE)

# Load the map of iv to survey data (will eventually do a merge)
iv.map <- read.csv("in-independent-variables-map.csv", header = TRUE, sep = ",", quote = "'\"",
                   na.strings=c("", "\"\""), stringsAsFactors=FALSE)

# Load the weights to calculate CC
ws <- read.csv("in-weights.csv", header = TRUE, sep = ",", quote = "'\"", na.strings=c("", "\"\""),
               stringsAsFactors=FALSE)

ls()
```

###Basic checkings
We also check the files is what this script expects. If this fails, then we need to either fix the input files or fix this script. This is just preemptive programming
```{r check-files}
# This whole block is checking we are dealing with the right input files
# This are the variable names that we expect in the data (LimeSurvey file)
data.names <- c("id", "submitdate", "lastpage", "startlanguage", "startdate", "datestamp",
                "Consent", "Gender", "Age", "Degree", "Role.R1", "Role.R2", "Role.R3", "Role.R4",
                "Role.R5", "Role.R6", "Role.R7", "Role.R8", "Role.R9", "Role.R10", "Role.other",
                "Bias.B1", "Bias.B2", "Bias.B3", "Bias.B4", "Bias.B5", "Bias.B6", "Bias.B7",
                "Bias.B8", "Bias.B9", "Bias.B10", "Bias.other", "IT", "Work", "Training",
                "Notation.None", "Notation.BPMN", "Notation.EPC", "Notation.UMLAD", "Notation.UML",
                "Notation.CMMN", "Notation.other", "SetId", "Tutorial", "Experience", "Model1Q1a",
                "Model1Q2a", "Model1Q3a", "Model1Q4a", "Model1Q5a.SQ001", "Model1Q5a.SQ002",
                "Model1Q5a.SQ003", "Model1Q5a.SQ004", "Model1Q5a.SQ005", "Model1Q5a.SQ006",
                "Perceived1a.ans", "Model2Q1a", "Model2Q2a", "Model2Q3a", "Model2Q4a",
                "Model2Q5a.SQ001", "Model2Q5a.SQ002", "Model2Q5a.SQ003", "Model2Q5a.SQ004",
                "Model2Q5a.SQ005", "Model2Q5a.SQ006", "Perceived2a.ans", "Model3Q1a", "Model3Q2a",
                "Model3Q3a", "Model3Q4a", "Model3Q5a.SQ001", "Model3Q5a.SQ002", "Model3Q5a.SQ003",
                "Model3Q5a.SQ004", "Model3Q5a.SQ005", "Model3Q5a.SQ006", "Perceived3a.ans",
                "Model4Q1a", "Model4Q2a", "Model4Q3a", "Model4Q4a", "Model4Q5a.SQ001",
                "Model4Q5a.SQ002", "Model4Q5a.SQ003", "Model4Q5a.SQ004", "Model4Q5a.SQ005",
                "Model4Q5a.SQ006", "Perceived4a.ans", "Model5Q1a", "Model5Q2a", "Model5Q3a",
                "Model5Q4a", "Model5Q5a.SQ001", "Model5Q5a.SQ002", "Model5Q5a.SQ003",
                "Model5Q5a.SQ004", "Model5Q5a.SQ005", "Model5Q5a.SQ006", "Perceived5a.ans",
                "Model6Q1a", "Model6Q2a", "Model6Q3a", "Model6Q4a", "Model6Q5a.SQ001",
                "Model6Q5a.SQ002", "Model6Q5a.SQ003", "Model6Q5a.SQ004", "Model6Q5a.SQ005",
                "Model6Q5a.SQ006", "Perceived6a.ans", "Model1Q1b", "Model1Q2b", "Model1Q3b",
                "Model1Q4b", "Model1Q5b.SQ001", "Model1Q5b.SQ002", "Model1Q5b.SQ003",
                "Model1Q5b.SQ004", "Model1Q5b.SQ005", "Model1Q5b.SQ006", "Perceived1b.ans",
                "Model2Q1b", "Model2Q2b", "Model2Q3b", "Model2Q4b", "Model2Q5b.SQ001",
                "Model2Q5b.SQ002", "Model2Q5b.SQ003", "Model2Q5b.SQ004", "Model2Q5b.SQ005",
                "Model2Q5b.SQ006", "Perceived2b.ans", "Model3Q1b", "Model3Q2b", "Model3Q3b",
                "Model3Q4b", "Model3Q5b.SQ001", "Model3Q5b.SQ002", "Model3Q5b.SQ003",
                "Model3Q5b.SQ004", "Model3Q5b.SQ005", "Model3Q5b.SQ006", "Perceived3b.ans",
                "Model4Q1b", "Model4Q2b", "Model4Q3b", "Model4Q4b", "Model4Q5b.SQ001",
                "Model4Q5b.SQ002", "Model4Q5b.SQ003", "Model4Q5b.SQ004", "Model4Q5b.SQ005",
                "Model4Q5b.SQ006", "Perceived4b.ans", "Model5Q1b", "Model5Q2b", "Model5Q3b",
                "Model5Q4b", "Model5Q5b.SQ001", "Model5Q5b.SQ002", "Model5Q5b.SQ003",
                "Model5Q5b.SQ004", "Model5Q5b.SQ005", "Model5Q5b.SQ006", "Perceived5b.ans",
                "Compare1vs2.ans", "Compare1vs3.ans", "Compare1vs4.ans", "Compare1vs5.ans",
                "Compare1vs6.ans", "Compare2vs1.ans", "Compare2vs3.ans", "Compare2vs4.ans",
                "Compare2vs5.ans", "Compare2vs6.ans", "Compare3vs1.ans", "Compare3vs2.ans",
                "Compare3vs4.ans", "Compare3vs5.ans", "Compare3vs6.ans", "Compare4vs1.ans",
                "Compare4vs2.ans", "Compare4vs3.ans", "Compare4vs5.ans", "Compare4vs6.ans",
                "Compare5vs1.ans", "Compare5vs2.ans", "Compare5vs3.ans", "Compare5vs4.ans",
                "Compare5vs6.ans", "Compare6vs1.ans", "Compare6vs2.ans", "Compare6vs3.ans",
                "Compare6vs4.ans", "Compare6vs5.ans", "Weights.CasePlan", "Weights.Stage",
                "Weights.DStage", "Weights.PlanFrag", "Weights.CFileItem", "Weights.Task",
                "Weights.DTask", "Weights.NBHTask", "Weights.ProcTask", "Weights.CaseTask",
                "Weights.CaseTasknim", "Weights.BHTask", "Weights.Event", "Weights.UserEvent",
                "Weights.TimerEvent", "Weights.Milestone", "Weights.Connector", "Weights.HumanIcon",
                "Weights.CPlanningT", "Weights.EPlanningT", "Weights.AComplete",
                "Weights.Collapsed", "Weights.Expanded", "Weights.ManualA", "Weights.Repetition",
                "Weights.Required", "Weights.EntryCritWC", "Weights.EntryCrit",
                "Weights.ExitCritWC", "Weights.ExitCrit", "Weights.EntryCritAND",
                "Weights.EntryCritOR", "Weights.ExitCritAND", "Weights.ExitCritOR", "Charity",
                "Charity.other", "EarlyAccess", "Final", "interviewtime", "groupTime1",
                "ConsentTime", "groupTime2", "GenderTime", "AgeTime", "DegreeTime", "RoleTime",
                "BiasTime", "ITTime", "WorkTime", "TrainingTime", "NotationTime", "SetIdTime",
                "groupTime3", "TutorialTime", "ExperienceTime", "groupTime5", "Model1Q1aTime",
                "Model1Q2aTime", "Model1Q3aTime", "Model1Q4aTime", "Model1Q5aTime",
                "Perceived1aTime", "groupTime6", "Model2Q1aTime", "Model2Q2aTime", "Model2Q3aTime",
                "Model2Q4aTime", "Model2Q5aTime", "Perceived2aTime", "groupTime7", "Model3Q1aTime",
                "Model3Q2aTime", "Model3Q3aTime", "Model3Q4aTime", "Model3Q5aTime",
                "Perceived3aTime", "groupTime8", "Model4Q1aTime", "Model4Q2aTime", "Model4Q3aTime",
                "Model4Q4aTime", "Model4Q5aTime", "Perceived4aTime", "groupTime9", "Model5Q1aTime",
                "Model5Q2aTime", "Model5Q3aTime", "Model5Q4aTime", "Model5Q5aTime",
                "Perceived5aTime", "groupTime10", "Model6Q1aTime", "Model6Q2aTime", "Model6Q3aTime",
                "Model6Q4aTime", "Model6Q5aTime", "Perceived6aTime", "groupTime11", "Model1Q1bTime",
                "Model1Q2bTime", "Model1Q3bTime", "Model1Q4bTime", "Model1Q5bTime",
                "Perceived1bTime", "groupTime12", "Model2Q1bTime", "Model2Q2bTime", "Model2Q3bTime",
                "Model2Q4bTime", "Model2Q5bTime", "Perceived2bTime", "groupTime13", "Model3Q1bTime",
                "Model3Q2bTime", "Model3Q3bTime", "Model3Q4bTime", "Model3Q5bTime",
                "Perceived3bTime", "groupTime14", "Model4Q1bTime", "Model4Q2bTime", "Model4Q3bTime",
                "Model4Q4bTime", "Model4Q5bTime", "Perceived4bTime", "groupTime15", "Model5Q1bTime",
                "Model5Q2bTime", "Model5Q3bTime", "Model5Q4bTime", "Model5Q5bTime",
                "Perceived5bTime", "groupTime16", "Compare1vs2Time", "groupTime17",
                "Compare1vs3Time", "groupTime18", "Compare1vs4Time", "groupTime19",
                "Compare1vs5Time", "groupTime20", "Compare1vs6Time", "groupTime21",
                "Compare2vs1Time", "groupTime22", "Compare2vs3Time", "groupTime23",
                "Compare2vs4Time", "groupTime24", "Compare2vs5Time", "groupTime25",
                "Compare2vs6Time", "groupTime26", "Compare3vs1Time", "groupTime27",
                "Compare3vs2Time", "groupTime28", "Compare3vs4Time", "groupTime29",
                "Compare3vs5Time", "groupTime30", "Compare3vs6Time", "groupTime31",
                "Compare4vs1Time", "groupTime32", "Compare4vs2Time", "groupTime33",
                "Compare4vs3Time", "groupTime34", "Compare4vs5Time", "groupTime35",
                "Compare4vs6Time", "groupTime36", "Compare5vs1Time", "groupTime37",
                "Compare5vs2Time", "groupTime38", "Compare5vs3Time", "groupTime39",
                "Compare5vs4Time", "groupTime40", "Compare5vs6Time", "groupTime41",
                "Compare6vs1Time", "groupTime42", "Compare6vs2Time", "groupTime43",
                "Compare6vs3Time", "groupTime44", "Compare6vs4Time", "groupTime45",
                "Compare6vs5Time", "groupTime4", "WeightsTime", "groupTime46", "CharityTime",
                "EarlyAccessTime", "FinalTime")

# This are the variable names that we expect in the independent variables file
iv.names <- c("iv.Model", "iv.CC", "iv.CL", "iv.CS", "iv.CAS", "iv.Q1", "iv.Q2", "iv.Q3", 
    "iv.Q4", "iv.Q5.R1", "iv.Q5.R2", "iv.Q5.R3", "iv.Q5.R4", "iv.Q5.R5", "iv.Q5.R6", 
    "iv.Q5.Text", "iv.w.CasePlan", "iv.w.Stage", "iv.w.DStage", "iv.w.PlanFrag", 
    "iv.w.CFileItem", "iv.w.Task", "iv.w.DTask", "iv.w.NBHTask", "iv.w.ProcTask", 
    "iv.w.CaseTask", "iv.w.CaseTasknim", "iv.w.BHTask", "iv.w.Event", "iv.w.UserEvent",
    "iv.w.TimerEvent", "iv.w.Milestone", "iv.w.Connector", "iv.w.HumanIcon", "iv.w.CPlanningT",
    "iv.w.EPlanningT",  "iv.w.AComplete", "iv.w.Collapsed", "iv.w.Expanded",
    "iv.w.ManualA", "iv.w.Repetition", "iv.w.Required", "iv.w.EntryCritWC", "iv.w.EntryCrit",
    "iv.w.ExitCritWC", "iv.w.ExitCrit", "iv.w.EntryCritAND", "iv.w.EntryCritOR", 
    "iv.w.ExitCritAND", "iv.w.ExitCritOR", "iv.CAS.SE", "iv.CAS.SX", "iv.CAS.MH", "iv.CAS.MP",
    "iv.CAS.MC", "iv.CAS.MT")


# These are the variable names that we expect in the independent variables mapping file
iv.map.names <- c("SetId", "iv.set", "iv.order", "iv.A.model", "iv.A.mode", "iv.A.name", 
    "iv.B.model", "iv.B.mode", "iv.B.name", "iv.C.obs", "iv.C.calc", "iv.C.CC",
    "iv.C.order3.CC","iv.C.order15.CC","iv.C.CL","iv.C.order3.CL","iv.C.order15.CL",
    "iv.C.CS","iv.C.order3.CS","iv.C.order15.CS","iv.C.CAS","iv.C.order3.CAS","iv.C.order15.CAS")

# These are the variables containing weights
weight.names <- c("iv.w.CasePlan","iv.w.Stage","iv.w.DStage","iv.w.PlanFrag","iv.w.CFileItem",
    "iv.w.Task","iv.w.DTask","iv.w.NBHTask","iv.w.ProcTask","iv.w.CaseTask","iv.w.CaseTasknim",
    "iv.w.BHTask","iv.w.Event","iv.w.UserEvent","iv.w.TimerEvent","iv.w.Milestone",
    "iv.w.Connector","iv.w.HumanIcon","iv.w.CPlanningT","iv.w.EPlanningT",
    "iv.w.AComplete","iv.w.Collapsed","iv.w.Expanded","iv.w.ManualA","iv.w.Repetition",
    "iv.w.Required","iv.w.EntryCritWC","iv.w.EntryCrit","iv.w.ExitCritWC","iv.w.ExitCrit",
    "iv.w.EntryCritAND","iv.w.EntryCritOR","iv.w.ExitCritAND","iv.w.ExitCritOR")

#Check we have the right variables
if(!identical(sort(na.omit(data.names)),sort(na.omit(names(data)))))
{
stop(paste0("data:[",data.names,"] = [", names(data),"]"))
#knit_exit()
}

if(!identical(sort(na.omit(iv.names)),sort(na.omit(names(iv)))))
stop(paste("iv frame. Expecting names:",iv.names,"But, instead got:", names(iv)))

if(!identical(sort(na.omit(iv.map.names)),sort(na.omit(names(iv.map)))))
stop(paste("iv.map frame. Expecting names:",iv.map.names,"But, instead got:", names(iv.map)))

#Check size of iv and iv.map
if(!(length(iv$iv.Model)==6))stop("wrong iv frame size")
if(!(length(iv.map$SetId)==30))stop("wrong iv.map frame size")

#Complete iv.map with metrics from iv
#First, let add model A metrics
iv.map <- merge(x=iv.map, y=subset(iv, select = c(iv.Model, iv.CC, iv.CL, iv.CS, iv.CAS,
                                                  iv.w.CasePlan, iv.w.Stage, iv.w.DStage,
                                                  iv.w.PlanFrag, iv.w.CFileItem, iv.w.Task,
                                                  iv.w.DTask, iv.w.Event, iv.w.Milestone,
                                                  iv.w.Connector, iv.w.CPlanningT, iv.w.EPlanningT,
                                                  iv.w.AComplete, iv.w.Collapsed, iv.w.Expanded,
                                                  iv.w.ManualA, iv.w.Repetition, iv.w.Required,
                                                  iv.w.HumanIcon, iv.CAS.SE, iv.CAS.SX, iv.CAS.MH,
                                                  iv.CAS.MP, iv.CAS.MC, iv.CAS.MT)), 
             by.x = "iv.A.model", by.y="iv.Model", all.x = TRUE)
colnames(iv.map)[colnames(iv.map)=="iv.CC"]  <- "iv.A.CC"
colnames(iv.map)[colnames(iv.map)=="iv.CL"]  <- "iv.A.CL"
colnames(iv.map)[colnames(iv.map)=="iv.CS"]  <- "iv.A.CS"
colnames(iv.map)[colnames(iv.map)=="iv.CAS"] <- "iv.A.CAS"
colnames(iv.map)[colnames(iv.map)=="iv.w.CasePlan"] <- "iv.A.CS.SC"
colnames(iv.map)[colnames(iv.map)=="iv.w.Stage"] <- "iv.A.CS.SS"
colnames(iv.map)[colnames(iv.map)=="iv.w.DStage"] <- "iv.A.CS.SDS"
colnames(iv.map)[colnames(iv.map)=="iv.w.PlanFrag"] <- "iv.A.CS.SPF"
colnames(iv.map)[colnames(iv.map)=="iv.w.CFileItem"] <- "iv.A.CS.DI"
colnames(iv.map)[colnames(iv.map)=="iv.w.Task"] <- "iv.A.CS.PT"
colnames(iv.map)[colnames(iv.map)=="iv.w.DTask"] <- "iv.A.CS.PDT"
colnames(iv.map)[colnames(iv.map)=="iv.w.Event"] <- "iv.A.CS.PE"
colnames(iv.map)[colnames(iv.map)=="iv.w.Milestone"] <- "iv.A.CS.PM"
colnames(iv.map)[colnames(iv.map)=="iv.w.Connector"] <- "iv.A.CS.OC"
colnames(iv.map)[colnames(iv.map)=="iv.w.CPlanningT"] <- "iv.A.CAS.DCP"
colnames(iv.map)[colnames(iv.map)=="iv.w.EPlanningT"] <- "iv.A.CAS.DEP"
colnames(iv.map)[colnames(iv.map)=="iv.w.AComplete"] <- "iv.A.CAS.DAC"
colnames(iv.map)[colnames(iv.map)=="iv.w.Collapsed"] <- "iv.A.CAS.DC"
colnames(iv.map)[colnames(iv.map)=="iv.w.Expanded"] <- "iv.A.CAS.DE"
colnames(iv.map)[colnames(iv.map)=="iv.w.ManualA"] <- "iv.A.CAS.DMA"
colnames(iv.map)[colnames(iv.map)=="iv.w.Repetition"] <- "iv.A.CAS.DRN"
colnames(iv.map)[colnames(iv.map)=="iv.w.Required"] <- "iv.A.CAS.DR"
colnames(iv.map)[colnames(iv.map)=="iv.CAS.SE"] <- "iv.A.CAS.SE"
colnames(iv.map)[colnames(iv.map)=="iv.CAS.SX"] <- "iv.A.CAS.SX"
colnames(iv.map)[colnames(iv.map)=="iv.CAS.MH"] <- "iv.A.CAS.MH"
colnames(iv.map)[colnames(iv.map)=="iv.CAS.MP"] <- "iv.A.CAS.MP"
colnames(iv.map)[colnames(iv.map)=="iv.CAS.MC"] <- "iv.A.CAS.MC"
colnames(iv.map)[colnames(iv.map)=="iv.w.HumanIcon"] <- "iv.A.CAS.MHB"
colnames(iv.map)[colnames(iv.map)=="iv.CAS.MT"] <- "iv.A.CAS.MT"

iv.map$iv.Model <- NULL

#Second, let add model B metrics
iv.map <- merge(x=iv.map, y=subset(iv, select = c(iv.Model, iv.CC, iv.CL, iv.CS, iv.CAS,
                                                  iv.w.CasePlan, iv.w.Stage, iv.w.DStage,
                                                  iv.w.PlanFrag, iv.w.CFileItem, iv.w.Task,
                                                  iv.w.DTask, iv.w.Event, iv.w.Milestone,
                                                  iv.w.Connector, iv.w.CPlanningT, iv.w.EPlanningT,
                                                  iv.w.AComplete, iv.w.Collapsed, iv.w.Expanded,
                                                  iv.w.ManualA, iv.w.Repetition, iv.w.Required,
                                                  iv.w.HumanIcon, iv.CAS.SE, iv.CAS.SX, iv.CAS.MH,
                                                  iv.CAS.MP, iv.CAS.MC, iv.CAS.MT)), 
             by.x = "iv.B.model", by.y="iv.Model", all.x = TRUE)
colnames(iv.map)[colnames(iv.map)=="iv.CC"]  <- "iv.B.CC"
colnames(iv.map)[colnames(iv.map)=="iv.CL"]  <- "iv.B.CL"
colnames(iv.map)[colnames(iv.map)=="iv.CS"]  <- "iv.B.CS"
colnames(iv.map)[colnames(iv.map)=="iv.CAS"] <- "iv.B.CAS"
colnames(iv.map)[colnames(iv.map)=="iv.w.CasePlan"] <- "iv.B.CS.SC"
colnames(iv.map)[colnames(iv.map)=="iv.w.Stage"] <- "iv.B.CS.SS"
colnames(iv.map)[colnames(iv.map)=="iv.w.DStage"] <- "iv.B.CS.SDS"
colnames(iv.map)[colnames(iv.map)=="iv.w.PlanFrag"] <- "iv.B.CS.SPF"
colnames(iv.map)[colnames(iv.map)=="iv.w.CFileItem"] <- "iv.B.CS.DI"
colnames(iv.map)[colnames(iv.map)=="iv.w.Task"] <- "iv.B.CS.PT"
colnames(iv.map)[colnames(iv.map)=="iv.w.DTask"] <- "iv.B.CS.PDT"
colnames(iv.map)[colnames(iv.map)=="iv.w.Event"] <- "iv.B.CS.PE"
colnames(iv.map)[colnames(iv.map)=="iv.w.Milestone"] <- "iv.B.CS.PM"
colnames(iv.map)[colnames(iv.map)=="iv.w.Connector"] <- "iv.B.CS.OC"
colnames(iv.map)[colnames(iv.map)=="iv.w.CPlanningT"] <- "iv.B.CAS.DCP"
colnames(iv.map)[colnames(iv.map)=="iv.w.EPlanningT"] <- "iv.B.CAS.DEP"
colnames(iv.map)[colnames(iv.map)=="iv.w.AComplete"] <- "iv.B.CAS.DAC"
colnames(iv.map)[colnames(iv.map)=="iv.w.Collapsed"] <- "iv.B.CAS.DC"
colnames(iv.map)[colnames(iv.map)=="iv.w.Expanded"] <- "iv.B.CAS.DE"
colnames(iv.map)[colnames(iv.map)=="iv.w.ManualA"] <- "iv.B.CAS.DMA"
colnames(iv.map)[colnames(iv.map)=="iv.w.Repetition"] <- "iv.B.CAS.DRN"
colnames(iv.map)[colnames(iv.map)=="iv.w.Required"] <- "iv.B.CAS.DR"
colnames(iv.map)[colnames(iv.map)=="iv.CAS.SE"] <- "iv.B.CAS.SE"
colnames(iv.map)[colnames(iv.map)=="iv.CAS.SX"] <- "iv.B.CAS.SX"
colnames(iv.map)[colnames(iv.map)=="iv.CAS.MH"] <- "iv.B.CAS.MH"
colnames(iv.map)[colnames(iv.map)=="iv.CAS.MP"] <- "iv.B.CAS.MP"
colnames(iv.map)[colnames(iv.map)=="iv.CAS.MC"] <- "iv.B.CAS.MC"
colnames(iv.map)[colnames(iv.map)=="iv.w.HumanIcon"] <- "iv.B.CAS.MHB"
colnames(iv.map)[colnames(iv.map)=="iv.CAS.MT"] <- "iv.B.CAS.MT"

iv.map$iv.Model <- NULL

#Verify the CC, CS, CAS, and CTS calculations
ck <- data.frame(iv$iv.w.Stage)
ck$my.stages <- iv$iv.w.Stage + iv$iv.w.DStage
ck$my.tasks <- iv$iv.w.Task + iv$iv.w.DTask 
ck$my.tasks2 <- iv$iv.w.NBHTask + iv$iv.w.ProcTask + iv$iv.w.CaseTask + iv$iv.w.CaseTasknim + iv$iv.w.BHTask
ck$my.events <- iv$iv.w.UserEvent + iv$iv.w.TimerEvent
ck$my.entry.criteria <- iv$iv.w.EntryCritWC + iv$iv.w.EntryCrit  
ck$my.exit.criteria <- iv$iv.w.ExitCritWC + iv$iv.w.ExitCrit 
#Check consistency
if(!identical(as.integer(ck$my.tasks),as.integer(ck$my.tasks2))) 
{
  print(ck$my.tasks)
  print(ck$my.tasks2)
  # if this stop is reached change it to print to investigate (but remember to change it back)
  stop("problem with tasks") 
}
if(!identical(iv$iv.w.Event,ck$my.events)) 
{
  print(iv$iv.w.Event)
  print(ck$my.events)
  # if this stop is reached change it to print to investigate (but remember to change it back)
  stop("problem with events")  
}
# My calculations
# CMMN Size (CS)
ck$my.cs <- iv$iv.w.CasePlan + iv$iv.w.Stage + iv$iv.w.DStage + iv$iv.w.PlanFrag + iv$iv.w.CFileItem + iv$iv.w.Task + iv$iv.w.DTask + iv$iv.w.Event + iv$iv.w.Milestone + iv$iv.w.Connector

if(!identical(as.integer(ck$my.cs),as.integer(iv$iv.CS)))
{
  print(ck$my.cs)
  print(iv$iv.CS)
  # if this stop is reached change it to print to investigate (but remember to change it back)
  stop("problems with CS") 
}

# CMMN annotators size (CAS)
ck$my.cas <- iv$iv.w.CPlanningT + iv$iv.w.EPlanningT + iv$iv.w.AComplete + iv$iv.w.Collapsed + iv$iv.w.Expanded + iv$iv.w.ManualA + iv$iv.w.Repetition + iv$iv.w.Required + iv$iv.w.EntryCritWC + iv$iv.w.EntryCrit + iv$iv.w.ExitCritWC + iv$iv.w.ExitCrit + iv$iv.w.NBHTask + iv$iv.w.ProcTask + iv$iv.w.CaseTasknim + iv$iv.w.CaseTask + iv$iv.w.HumanIcon + iv$iv.w.TimerEvent 


if(!identical(as.integer(ck$my.cas),as.integer(iv$iv.CAS)))
{
  print(ck$my.cas)
  print(iv$iv.CAS)
  # if this stop is reached change it to print to investigate (but remember to change it back)
  stop("problems with CAS") 
}

#CMMN Total size (CTS) NOTE that CTS is constant at 90
ck$my.cts <- ck$my.cas + ck$my.cs

if(!identical(ifelse(ck$my.cts == 90, NA,"BAD"),c(NA,NA,NA,NA,NA,NA)))
{
  print("CTS must be constant at 90")
  print(ck$my.cts)
  # if this stop is reached change it to print to investigate (but remember to change it back)
  stop("problems with CTS") 
}

ck$CC.Calculated <- rowSums(data.frame(with(ws,{Map(`*`,iv[weight.names],mget(paste0(weight.names,".W")))})))


if(!identical(as.integer(ck$CC.Calculated),as.integer(iv$iv.CC)))
{
  print(ck$CC.Calculated)
  print(iv$iv.CC)
  str(ck$CC.Calculated)
  str(iv$iv.CC)
  # if this stop is reached change it to print to investigate (but remember to change it back)
  stop("problems with CC") 
}

# Let now check that we exported correctly from LimeSurvey
# We must not use LimeSurvey to convert Y and N to 1 or 2,
# because then we cannot distinguish No and No Answer.
# In here we will check few variables to see if we used LimeSurvey to do the conversion
# (we will not check every single variable, because it will be too much)
if(length(which(data$Role.R1 == 2))) 
  stop("problems with LimeSurvey export (used: Responses -> Answer codes -> Convert Y to 1 and Convert Y to 2)") 

# Not needed anymore
rm(ck, iv.names, iv.map.names, data.names)

```

Now, we display each variable in the data set as follows:  

**(number of rows) Number of observation -- Name [Type]**
```{r print-data-vars}
# Uncomment the following lines to list the loaded data and its types
#summary(data)
#str(data,vec.len=2,give.attr=TRUE,give.length=TRUE,give.head=TRUE,list.len=800)
#print("(rows) Observations - Name[Type]")
for(n in sort(names(data)))
{
  if(length(na.omit(data[[n]]))) 
    print(paste("(1:",length(data[[n]]),") ", length(na.omit(data[[n]])), 
                " - ", n, " [", class(data[[n]]), "]", sep=""))
}

```

Now we print the independent variable (iv) frame. 

```{r print-iv-vars}
str(iv)

```

We now print a file with the comments left by the subjects. 
This file should be analysed separately 
```{r generate-comments}
# We generate an output file with the comments from the survey
write.csv(paste("\nCOMMENT:\n",na.omit(data$Final),"\nEND"), 
          file = "out-comments.txt",row.names=FALSE, na="")
```

We remove columns that are either empty (like all the columns about timing of questions, but not group timing, that will be deleted later), or that we are not using.
```{r remove-empty}
data$startlanguage <- NULL
data$datestamp <- NULL
data$Final <- NULL # These are the comments the subjects left for the researchers
                   # We already printed them in an output file for further analysis
data$ConsentTime <- NULL
data$GenderTime <- NULL
data$AgeTime <- NULL
data$DegreeTime <- NULL
data$ITTime <- NULL
data$WorkTime <- NULL
data$TrainingTime <- NULL
data$NotationTime <- NULL
data$SetIdTime <- NULL
data$TutorialTime <- NULL
data$ExperienceTime <- NULL
data$Model1Q1aTime <- NULL
data$Model1Q2aTime <- NULL
data$Model1Q3aTime <- NULL
data$Model1Q4aTime <- NULL
data$Model1Q5aTime <- NULL
data$Perceived1aTime <- NULL
data$Model2Q1aTime <- NULL
data$Model2Q2aTime <- NULL
data$Model2Q3aTime <- NULL
data$Model2Q4aTime <- NULL
data$Model2Q5aTime <- NULL
data$Perceived2aTime <- NULL
data$Model3Q1aTime <- NULL
data$Model3Q2aTime <- NULL
data$Model3Q3aTime <- NULL
data$Model3Q4aTime <- NULL
data$Model3Q5aTime <- NULL
data$Perceived3aTime <- NULL
data$Model4Q1aTime <- NULL
data$Model4Q2aTime <- NULL
data$Model4Q3aTime <- NULL
data$Model4Q4aTime <- NULL
data$Model4Q5aTime <- NULL
data$Perceived4aTime <- NULL
data$Model5Q1aTime <- NULL
data$Model5Q2aTime <- NULL
data$Model5Q3aTime <- NULL
data$Model5Q4aTime <- NULL
data$Model5Q5aTime <- NULL
data$Perceived5aTime <- NULL
data$Model6Q1aTime <- NULL
data$Model6Q2aTime <- NULL
data$Model6Q3aTime <- NULL
data$Model6Q4aTime <- NULL
data$Model6Q5aTime <- NULL
data$Perceived6aTime <- NULL
data$Model1Q1bTime <- NULL
data$Model1Q2bTime <- NULL
data$Model1Q3bTime <- NULL
data$Model1Q4bTime <- NULL
data$Model1Q5bTime <- NULL
data$Perceived1bTime <- NULL
data$Model2Q1bTime <- NULL
data$Model2Q2bTime <- NULL
data$Model2Q3bTime <- NULL
data$Model2Q4bTime <- NULL
data$Model2Q5bTime <- NULL
data$Perceived2bTime <- NULL
data$Model3Q1bTime <- NULL
data$Model3Q2bTime <- NULL
data$Model3Q3bTime <- NULL
data$Model3Q4bTime <- NULL
data$Model3Q5bTime <- NULL
data$Perceived3bTime <- NULL
data$Model4Q1bTime <- NULL
data$Model4Q2bTime <- NULL
data$Model4Q3bTime <- NULL
data$Model4Q4bTime <- NULL
data$Model4Q5bTime <- NULL
data$Perceived4bTime <- NULL
data$Model5Q1bTime <- NULL
data$Model5Q2bTime <- NULL
data$Model5Q3bTime <- NULL
data$Model5Q4bTime <- NULL
data$Model5Q5bTime <- NULL
data$Perceived5bTime <- NULL
data$Compare1vs2Time <- NULL
data$Compare1vs3Time <- NULL
data$Compare1vs4Time <- NULL
data$Compare1vs5Time <- NULL
data$Compare1vs6Time <- NULL
data$Compare2vs1Time <- NULL
data$Compare2vs3Time <- NULL
data$Compare2vs4Time <- NULL
data$Compare2vs5Time <- NULL
data$Compare2vs6Time <- NULL
data$Compare3vs1Time <- NULL
data$Compare3vs2Time <- NULL
data$Compare3vs4Time <- NULL
data$Compare3vs5Time <- NULL
data$Compare3vs6Time <- NULL
data$Compare4vs1Time <- NULL
data$Compare4vs2Time <- NULL
data$Compare4vs3Time <- NULL
data$Compare4vs5Time <- NULL
data$Compare4vs6Time <- NULL
data$Compare5vs1Time <- NULL
data$Compare5vs2Time <- NULL
data$Compare5vs3Time <- NULL
data$Compare5vs4Time <- NULL
data$Compare5vs6Time <- NULL
data$Compare6vs1Time <- NULL
data$Compare6vs2Time <- NULL
data$Compare6vs3Time <- NULL
data$Compare6vs4Time <- NULL
data$Compare6vs5Time <- NULL
data$NotationComplexityTime <- NULL
data$FinalTime <- NULL

rm(n)
ls() # Should have data, iv, iv.map, ws, and weight.names
```

#Validating and calculating new data
To implement the pairwise comparisons in LimeSurvey, we were forced to duplicate groups and questions. 
Now we need to combine them again. 
But before we do that, using preventive programming, we need to validate that there is no overlaps. 
This function will be used for that purpose.

```{r validate-data-func, echo = TRUE}
check.no.overlap <- function(a,b) #a and b must be vectors
{
  if(length(a) > length(b)) n <- length(a) else n <- length(b)
  for(i in 1:n)
  {
    if((!is.na(a[i])) && (!is.na(b[i])))
    {
      an <- deparse(substitute(a)) # Get the name of the vector a
      bn <- deparse(substitute(b)) # Get the name of the vector b
      stop(paste("Error: Overlap between ",an," and ",bn))
    }
  }
}
```

## Combining the Perceived variables
In LimeSurvey, we were forced to duplicate five of the models to implement the code that shows only two models to each subject.
The calculated variable data$SetId has 30 values (1:30) that indicates which two models were shown to the subject.
For each model we have six questions (five model questions plus one perceived complexity question), and Because of LimeSurvey we have six *a* models and five *b* models, which gives us 111 columns.
The problem in LimeSurvey is that groups are shown to a subject sequentially, so if we want to show model 1 first and model 2 second, we must place model 1 in group 1 and model two in group 2.
But, then when we want to show (to a different subject) model 2 first and model 1 second, we cannot do that, because we need to skip group 1 and show group 2 (model 2) first, but cannot go back, so now we need a group 3 which is just a duplicated group 1.
In addition, we don't care much about individual question, but we care about the number of correct questions.
So, now We need to consolidate all those columns into few.

For example, SetId == 1 indicates the subject was exposed to model 1a and model 2a.
Therefore, a row with SetId == 1 should have data in the following 22 columns (assuming the subject answer all the questions):  

Model1Q1a, Model1Q2a, Model1Q3a, Model1Q4a, Model1Q5a-SQ001, Model1Q5a-SQ002, Model1Q5a-SQ003, Model1Q5a-SQ004, Model1Q5a-SQ005, Model1Q5a-SQ006, Perceived1a-ans,
Model2Q1a, Model2Q2a, Model2Q3a, Model2Q4a, Model2Q5a-SQ001, Model2Q5a-SQ002, Model2Q5a-SQ003, Model2Q5a-SQ004, Model2Q5a-SQ005, Model2Q5a-SQ006, Perceived2a-ans.

The resulting consolidated columns will be,

A.Correct, A.Perceived, B.Correct, B.perceived.

In addition, we will add ten columns to hold the independent variable as follows,

A.model, A.CC, A.CL, A.CS, A.CAS, B.model, B.CC, B.CL, B.CS, B.CAS.

We will start by merging the 22 perceived answers columns (from *Perceived1a.ans* to *Perceived5b.ans*) into *A.Perceived*, *B.perceived* as follows,

```{r combine-models}
# Need to generate A and B columns based on SetId
# First create the variables
data$A.perceived <- NA
data$B.perceived <- NA

data$SetId[is.na(data$SetId)] <- 0 #People that did not reached the tutorial page

# Now we will copy the correct column based on SetId
data$A.perceived[data$SetId==1] <- data$Perceived1a.ans[data$SetId==1]
data$B.perceived[data$SetId==1] <- data$Perceived2a.ans[data$SetId==1]
data$A.perceived[data$SetId==2] <- data$Perceived1a.ans[data$SetId==2]
data$B.perceived[data$SetId==2] <- data$Perceived3a.ans[data$SetId==2]
data$A.perceived[data$SetId==3] <- data$Perceived1a.ans[data$SetId==3]
data$B.perceived[data$SetId==3] <- data$Perceived4a.ans[data$SetId==3]
data$A.perceived[data$SetId==4] <- data$Perceived1a.ans[data$SetId==4]
data$B.perceived[data$SetId==4] <- data$Perceived5a.ans[data$SetId==4]
data$A.perceived[data$SetId==5] <- data$Perceived1a.ans[data$SetId==5]
data$B.perceived[data$SetId==5] <- data$Perceived6a.ans[data$SetId==5]
data$A.perceived[data$SetId==6] <- data$Perceived2a.ans[data$SetId==6]
data$B.perceived[data$SetId==6] <- data$Perceived1b.ans[data$SetId==6]
data$A.perceived[data$SetId==7] <- data$Perceived2a.ans[data$SetId==7]
data$B.perceived[data$SetId==7] <- data$Perceived3a.ans[data$SetId==7]
data$A.perceived[data$SetId==8] <- data$Perceived2a.ans[data$SetId==8]
data$B.perceived[data$SetId==8] <- data$Perceived4a.ans[data$SetId==8]
data$A.perceived[data$SetId==9] <- data$Perceived2a.ans[data$SetId==9]
data$B.perceived[data$SetId==9] <- data$Perceived5a.ans[data$SetId==9]
data$A.perceived[data$SetId==10] <- data$Perceived2a.ans[data$SetId==10]
data$B.perceived[data$SetId==10] <- data$Perceived6a.ans[data$SetId==10]
data$A.perceived[data$SetId==11] <- data$Perceived3a.ans[data$SetId==11]
data$B.perceived[data$SetId==11] <- data$Perceived1b.ans[data$SetId==11]
data$A.perceived[data$SetId==12] <- data$Perceived3a.ans[data$SetId==12]
data$B.perceived[data$SetId==12] <- data$Perceived2b.ans[data$SetId==12]
data$A.perceived[data$SetId==13] <- data$Perceived3a.ans[data$SetId==13]
data$B.perceived[data$SetId==13] <- data$Perceived4a.ans[data$SetId==13]
data$A.perceived[data$SetId==14] <- data$Perceived3a.ans[data$SetId==14]
data$B.perceived[data$SetId==14] <- data$Perceived5a.ans[data$SetId==14]
data$A.perceived[data$SetId==15] <- data$Perceived3a.ans[data$SetId==15]
data$B.perceived[data$SetId==15] <- data$Perceived6a.ans[data$SetId==15]
data$A.perceived[data$SetId==16] <- data$Perceived4a.ans[data$SetId==16]
data$B.perceived[data$SetId==16] <- data$Perceived1b.ans[data$SetId==16]
data$A.perceived[data$SetId==17] <- data$Perceived4a.ans[data$SetId==17]
data$B.perceived[data$SetId==17] <- data$Perceived2b.ans[data$SetId==17]
data$A.perceived[data$SetId==18] <- data$Perceived4a.ans[data$SetId==18]
data$B.perceived[data$SetId==18] <- data$Perceived3b.ans[data$SetId==18]
data$A.perceived[data$SetId==19] <- data$Perceived4a.ans[data$SetId==19]
data$B.perceived[data$SetId==19] <- data$Perceived5a.ans[data$SetId==19]
data$A.perceived[data$SetId==20] <- data$Perceived4a.ans[data$SetId==20]
data$B.perceived[data$SetId==20] <- data$Perceived6a.ans[data$SetId==20]
data$A.perceived[data$SetId==21] <- data$Perceived5a.ans[data$SetId==21]
data$B.perceived[data$SetId==21] <- data$Perceived1b.ans[data$SetId==21]
data$A.perceived[data$SetId==22] <- data$Perceived5a.ans[data$SetId==22]
data$B.perceived[data$SetId==22] <- data$Perceived2b.ans[data$SetId==22]
data$A.perceived[data$SetId==23] <- data$Perceived5a.ans[data$SetId==23]
data$B.perceived[data$SetId==23] <- data$Perceived3b.ans[data$SetId==23]
data$A.perceived[data$SetId==24] <- data$Perceived5a.ans[data$SetId==24]
data$B.perceived[data$SetId==24] <- data$Perceived4b.ans[data$SetId==24]
data$A.perceived[data$SetId==25] <- data$Perceived5a.ans[data$SetId==25]
data$B.perceived[data$SetId==25] <- data$Perceived6a.ans[data$SetId==25]
data$A.perceived[data$SetId==26] <- data$Perceived6a.ans[data$SetId==26]
data$B.perceived[data$SetId==26] <- data$Perceived1b.ans[data$SetId==26]
data$A.perceived[data$SetId==27] <- data$Perceived6a.ans[data$SetId==27]
data$B.perceived[data$SetId==27] <- data$Perceived2b.ans[data$SetId==27]
data$A.perceived[data$SetId==28] <- data$Perceived6a.ans[data$SetId==28]
data$B.perceived[data$SetId==28] <- data$Perceived3b.ans[data$SetId==28]
data$A.perceived[data$SetId==29] <- data$Perceived6a.ans[data$SetId==29]
data$B.perceived[data$SetId==29] <- data$Perceived4b.ans[data$SetId==29]
data$A.perceived[data$SetId==30] <- data$Perceived6a.ans[data$SetId==30]
data$B.perceived[data$SetId==30] <- data$Perceived5b.ans[data$SetId==30]

```

## Adding the independent variables map
From a memory usage perspective, here is the wrong place to do this, but
we want to generate intermediate files to check our calculations, and so, we are forced to move it earlier than really needed.
We now add the independent variables to the data set.

```{r merge-iv}
# clean up first
 iv.map$iv.A.mode  <- NULL
 iv.map$iv.B.mode  <- NULL

data <- merge(data, iv.map, by = "SetId", all.x = TRUE)
```

We now print a file with the calculations of[A|B].perceived
```{r generate-perceived-file}
# We also generate an output file with the comments from the survey
 if(params$test) write.csv(subset(data, select = c(id, SetId, iv.A.name, iv.B.name, A.perceived,
 Perceived1a.ans, Perceived2a.ans, Perceived3a.ans, Perceived4a.ans,
 Perceived5a.ans, Perceived6a.ans, B.perceived, Perceived1b.ans, Perceived2b.ans,
 Perceived3b.ans, Perceived4b.ans, Perceived5b.ans)),
 file = "out-perceived.csv",row.names=FALSE, na="")
```


## Pairwise comparisons
In the survey we presented some subjects with (A,B) comparisons, and other subjects with (B,A) comparisons. Each subject is presented with a single comparison.
In total, we have 30 sets of pairwise comparisons.
In here we will convert the (B,A) comparisons into (A,B) so that we cut by half the number of comparisons, and so we end with 15 pairwise comparisons.
The columns will be Model1vs2 to Model5vs6.

The resulting 15 pairwise comparisons will be further consolidated into a single column *C.Compare*.

```{r Comparisons}

merge.vectors <- function(a,b)
{
  check.no.overlap(a,b)  # First, be sure the two vectors do not overlap
  c <- rep(NA,length(a)) # Be sure to generate a vector of the correct size
  c <- rep(NA,length(b))

  c[is.na(a)] <- b[is.na(a)]
  c[is.na(b)] <- a[is.na(b)]
  return(c)
}

data$model2vs1 <- merge.vectors(data$Compare2vs1.ans,abs(data$Compare1vs2.ans -10))
data$model3vs1 <- merge.vectors(data$Compare3vs1.ans,abs(data$Compare1vs3.ans -10))
data$model4vs1 <- merge.vectors(data$Compare4vs1.ans,abs(data$Compare1vs4.ans -10))
data$model5vs1 <- merge.vectors(data$Compare5vs1.ans,abs(data$Compare1vs5.ans -10))
data$model6vs1 <- merge.vectors(data$Compare6vs1.ans,abs(data$Compare1vs6.ans -10))
data$model3vs2 <- merge.vectors(data$Compare3vs2.ans,abs(data$Compare2vs3.ans -10))
data$model4vs2 <- merge.vectors(data$Compare4vs2.ans,abs(data$Compare2vs4.ans -10))
data$model5vs2 <- merge.vectors(data$Compare5vs2.ans,abs(data$Compare2vs5.ans -10))
data$model6vs2 <- merge.vectors(data$Compare6vs2.ans,abs(data$Compare2vs6.ans -10))
data$model4vs3 <- merge.vectors(data$Compare4vs3.ans,abs(data$Compare3vs4.ans -10))
data$model5vs3 <- merge.vectors(data$Compare5vs3.ans,abs(data$Compare3vs5.ans -10))
data$model6vs3 <- merge.vectors(data$Compare6vs3.ans,abs(data$Compare3vs6.ans -10))
data$model5vs4 <- merge.vectors(data$Compare5vs4.ans,abs(data$Compare4vs5.ans -10))
data$model6vs4 <- merge.vectors(data$Compare6vs4.ans,abs(data$Compare4vs6.ans -10))
data$model6vs5 <- merge.vectors(data$Compare6vs5.ans,abs(data$Compare5vs6.ans -10))

#Create new variable
data$C.Compare <- NA

#Populate the variable
data$C.Compare[data$SetId==1] <- data$model2vs1[data$SetId==1]
data$C.Compare[data$SetId==2] <- data$model3vs1[data$SetId==2]
data$C.Compare[data$SetId==3] <- data$model4vs1[data$SetId==3]
data$C.Compare[data$SetId==4] <- data$model5vs1[data$SetId==4]
data$C.Compare[data$SetId==5] <- data$model6vs1[data$SetId==5]
data$C.Compare[data$SetId==6] <- data$model2vs1[data$SetId==6]
data$C.Compare[data$SetId==7] <- data$model3vs2[data$SetId==7]
data$C.Compare[data$SetId==8] <- data$model4vs2[data$SetId==8]
data$C.Compare[data$SetId==9] <- data$model5vs2[data$SetId==9]
data$C.Compare[data$SetId==10] <- data$model6vs2[data$SetId==10]
data$C.Compare[data$SetId==11] <- data$model3vs1[data$SetId==11]
data$C.Compare[data$SetId==12] <- data$model3vs2[data$SetId==12]
data$C.Compare[data$SetId==13] <- data$model4vs3[data$SetId==13]
data$C.Compare[data$SetId==14] <- data$model5vs3[data$SetId==14]
data$C.Compare[data$SetId==15] <- data$model6vs3[data$SetId==15]
data$C.Compare[data$SetId==16] <- data$model4vs1[data$SetId==16]
data$C.Compare[data$SetId==17] <- data$model4vs2[data$SetId==17]
data$C.Compare[data$SetId==18] <- data$model4vs3[data$SetId==18]
data$C.Compare[data$SetId==19] <- data$model5vs4[data$SetId==19]
data$C.Compare[data$SetId==20] <- data$model6vs4[data$SetId==20]
data$C.Compare[data$SetId==21] <- data$model5vs1[data$SetId==21]
data$C.Compare[data$SetId==22] <- data$model5vs2[data$SetId==22]
data$C.Compare[data$SetId==23] <- data$model5vs3[data$SetId==23]
data$C.Compare[data$SetId==24] <- data$model5vs4[data$SetId==24]
data$C.Compare[data$SetId==25] <- data$model6vs5[data$SetId==25]
data$C.Compare[data$SetId==26] <- data$model6vs1[data$SetId==26]
data$C.Compare[data$SetId==27] <- data$model6vs2[data$SetId==27]
data$C.Compare[data$SetId==28] <- data$model6vs3[data$SetId==28]
data$C.Compare[data$SetId==29] <- data$model6vs4[data$SetId==29]
data$C.Compare[data$SetId==30] <- data$model6vs5[data$SetId==30]

```

We now print a file with the calculations of C.Compare
```{r generate-compare-file}
# We also generate an output file with the comparisons from the survey
if(params$test) write.csv(subset(data, select = c(id, SetId, iv.A.name, iv.B.name, C.Compare,
 model2vs1, Compare1vs2.ans, Compare2vs1.ans, model3vs1, Compare1vs3.ans,
 Compare3vs1.ans, model3vs2, Compare3vs2.ans, Compare2vs3.ans, model4vs1,
 Compare1vs4.ans, Compare4vs1.ans, model4vs2, Compare2vs4.ans, Compare4vs2.ans,
 model4vs3, Compare4vs3.ans, Compare3vs4.ans, model5vs1, Compare1vs5.ans,
 Compare5vs1.ans, model5vs2, Compare5vs2.ans, Compare2vs5.ans, model5vs3,
 Compare5vs3.ans, Compare3vs5.ans, model5vs4, Compare5vs4.ans, Compare4vs5.ans,
 model6vs1, Compare1vs6.ans, Compare6vs1.ans, model6vs2, Compare2vs6.ans,
 Compare6vs2.ans, model6vs3, Compare3vs6.ans, Compare6vs3.ans, model6vs4,
 Compare4vs6.ans, Compare6vs4.ans, model6vs5, Compare5vs6.ans, Compare6vs5.ans)),
 file = "out-compare.csv",row.names=FALSE, na="")
```


##Calculating Correct answers, Efficacy, and Efficiency variables
The functions to calculate correct answers, efficacy and efficiency are

```{r calculate-efficacy-and-efficiency}
# Parameters to the following two functions:
# m is a number describing the model number that we are processing (from 1 to 6)
# t group time vector for the model. How long the subject spent answiring all the questions Q1 to Q5 for the model.
# Q1 to Q4 = questions Q1 to Q4 for that model (for example Model6Q1a)
# Q5.1 to Q5.6 = subquestions of Q5 (for example Model2Q5a.SQ003)
# iv is the independent variables frame that will be indexed with m
calc.correct <- function(m,Q1, Q2, Q3, Q4, Q5.1, Q5.2, Q5.3, Q5.4, Q5.5, Q5.6,iv)
{
  s <- rep(NA,length(Q1))
  for(i in 1:max(c(length(Q1),length(Q2),length(Q3),length(Q4),length(Q5.1),
                   length(Q5.2),length(Q5.3),length(Q5.4),length(Q5.5),
                   length(Q5.6)), na.rm = TRUE))
  {
    # if there is at least one answer initialize to zero, otherwise it is NA
    if((!is.na(Q1[i]))||(!is.na(Q2[i]))||(!is.na(Q3[i]))||(!is.na(Q4[i]))
       ||(!is.na(Q5.1[i]))||(!is.na(Q5.2[i]))||(!is.na(Q5.3[i]))
       ||(!is.na(Q5.4[i]))||(!is.na(Q5.5[i]))||(!is.na(Q5.6[i])))
    {
      s[i] <- 0 
      # increase correct count if 
      #                          (1)the question was asked to the subject (is not NA) 
      #                          (2)it has the correct value (Q1 is a count, all others are yes/no)
      if((!is.na(Q1[i]))  &&(Q1[i]==iv$iv.Q1[m])) s[i] <- s[i] + 1
      if((!is.na(Q2[i]))  &&(Q2[i]==iv$iv.Q2[m])) s[i] <- s[i] + 1
      if((!is.na(Q3[i]))  &&(Q3[i]==iv$iv.Q3[m])) s[i] <- s[i] + 1
      if((!is.na(Q4[i]))  &&(Q4[i]==iv$iv.Q4[m])) s[i] <- s[i] + 1
      
      Q5.good <- 0
      Q5.bad <- 0
      if(!is.na(Q5.1[i])) {if(Q5.1[i]==iv$iv.Q5.R1[m]) Q5.good <- Q5.good + 1 else Q5.bad <- Q5.bad + 1}
      if(!is.na(Q5.2[i])) {if(Q5.2[i]==iv$iv.Q5.R2[m]) Q5.good <- Q5.good + 1 else Q5.bad <- Q5.bad + 1}
      if(!is.na(Q5.3[i])) {if(Q5.3[i]==iv$iv.Q5.R3[m]) Q5.good <- Q5.good + 1 else Q5.bad <- Q5.bad + 1}
      if(!is.na(Q5.4[i])) {if(Q5.4[i]==iv$iv.Q5.R4[m]) Q5.good <- Q5.good + 1 else Q5.bad <- Q5.bad + 1}
      if(!is.na(Q5.5[i])) {if(Q5.5[i]==iv$iv.Q5.R5[m]) Q5.good <- Q5.good + 1 else Q5.bad <- Q5.bad + 1}
      if(!is.na(Q5.6[i])) {if(Q5.6[i]==iv$iv.Q5.R6[m]) Q5.good <- Q5.good + 1 else Q5.bad <- Q5.bad + 1}
      
      # This is very slow, but does not matter
      iv.Q5.ones <- 0
      if((Q5.good  > 0) && (!((Q5.good + Q5.bad) == 6)))
      {
        if(iv$iv.Q5.R1[m]==1) iv.Q5.ones <- iv.Q5.ones + 1
        if(iv$iv.Q5.R2[m]==1) iv.Q5.ones <- iv.Q5.ones + 1 
        if(iv$iv.Q5.R3[m]==1) iv.Q5.ones <- iv.Q5.ones + 1 
        if(iv$iv.Q5.R4[m]==1) iv.Q5.ones <- iv.Q5.ones + 1 
        if(iv$iv.Q5.R5[m]==1) iv.Q5.ones <- iv.Q5.ones + 1 
        if(iv$iv.Q5.R6[m]==1) iv.Q5.ones <- iv.Q5.ones + 1
      
        if((iv.Q5.ones==Q5.good)&&(Q5.bad==0)) s[i] <- s[i] + 1    
        else {
          s[i] <- s[i] + if(iv.Q5.ones==Q5.good) 0.75 else (if(Q5.bad > 0) 0.25 else 0.50)
        }
      }
    #cat(paste("Correct: s",s[i],"m",m,"[Q1",Q1[i],"Q2",Q2[i],"Q3",Q3[i],"Q4",Q4[i],
    #           "Q5(",Q5.1[i],",",Q5.2[i],",",Q5.3[i],",",Q5.4[i],",",Q5.5[i],",",Q5.6[i],
    #           ") one",iv.Q5.ones,"good",Q5.good,"bad",Q5.bad,"]\n"))
    }
      else s[i] <- NA
  }
  
  return(s) 
}

# Parameters 
# m is a number describing the model number that we are processing (from 1 to 6)
# t is the group time vector for the model. How long the subject spent understanding the model
#   and answering all the questions for the model.
# c is the vector with the count of correct answers
calc.efficacy <- function(m,t,c)
{ 
  # efficacy is defined as the number of correct answers divided by the number of questions
  # (10 in our case) 
  
  for(i in 1:length(c)) # first check that we have timing for each observation
  {
    if((!is.na(c[i]))&&(is.na(t[i])))
    {
      cn <- deparse(substitute(c))
      tn <- deparse(substitute(t))
      stop(paste("Missing timings for",cn," (timings in",tn,")"))
    }
  }
  
  return(c/5) 
}

# Parameters 
# m is a number describing the model number that we are processing (from 1 to 6)
# t is the group time vector for the model. How long the subject spent understanding the model
#   and answering all the questions for the model.
# c is the vector with the count of correct answers
calc.efficiency <- function(m,t,c)
{
  # efficiency is defined as the number of correct answers divided by the time it took 
  # the subject to answer
  
  for(i in 1:length(c)) # first check that we have timing for each observation
  {
    if((!is.na(c[i]))&&(is.na(t[i])))
    {
      cn <- deparse(substitute(c))
      tn <- deparse(substitute(t))
      stop(paste("Missing timings for",cn," (timings in",tn,")"))
    }
  }
  return(c/t)
 
}

```

###Renaming time variables
First we need to rename the time variables.
This section needs to be revisit every time the survey is deployed, because the number \<n\> in the groupTime\<n\> variables may change.
```{r rename-time-vars}
# First change the name of LimeSurvey generated group times.

# Note that in LimeSurvey we are using a group per page, and we are also requesting times
# so, we get times only for groups (no times per question -- these are zero)
# The name of the group time is groupTime<n>, where <n> is listed in the survey 
#     logic file as [GID <n>].

# NOTE: it seems like every time we deploy the survey the GID change, 
#       so every time the survey is deployed, we need to fix <n> in the groupTime<n> below

names(data)[names(data) == 'interviewtime'] <- 'Total.Time' ## Note that time is in seconds

names(data)[names(data) == 'groupTime1'] <- 'Concent.Time' #Informed concent time
names(data)[names(data) == 'groupTime3'] <- 'Tutorial.Time'

names(data)[names(data) == 'groupTime5']  <- 'Model1a.Time' # Model X1a
names(data)[names(data) == 'groupTime6']  <- 'Model2a.Time' # Model W2b
names(data)[names(data) == 'groupTime7']  <- 'Model3a.Time' # Model P3c
names(data)[names(data) == 'groupTime8']  <- 'Model4a.Time' # Model Z4d
names(data)[names(data) == 'groupTime9']  <- 'Model5a.Time' # Model T5e
names(data)[names(data) == 'groupTime10'] <- 'Model6a.Time' # Model Y6f
names(data)[names(data) == 'groupTime11'] <- 'Model1b.Time' # Model W1g
names(data)[names(data) == 'groupTime12'] <- 'Model2b.Time' # Model Y2h
names(data)[names(data) == 'groupTime13'] <- 'Model3b.Time' # Model T3i
names(data)[names(data) == 'groupTime14'] <- 'Model4b.Time' # Model P4j
names(data)[names(data) == 'groupTime15'] <- 'Model5b.Time' # Model Z5k
# There is no Model6b

# Now we can happily delete all the groupTime variables 
# (note that some groupTimes don't exists anymore because they were renamed,
#  but we still try to remove them, so if we change the renaming this still work)
data$groupTime1 <- NULL 
data$groupTime2 <- NULL 
data$groupTime3 <- NULL 
data$groupTime4 <- NULL 
data$groupTime5 <- NULL 
data$groupTime6 <- NULL 
data$groupTime7 <- NULL 
data$groupTime8 <- NULL 
data$groupTime9 <- NULL 
data$groupTime10 <- NULL 
data$groupTime11 <- NULL 
data$groupTime12 <- NULL 
data$groupTime13 <- NULL 
data$groupTime14 <- NULL 
data$groupTime15 <- NULL 
data$groupTime16 <- NULL 
data$groupTime17 <- NULL 
data$groupTime18 <- NULL 
data$groupTime19 <- NULL 
data$groupTime20 <- NULL 
data$groupTime21 <- NULL 
data$groupTime22 <- NULL 
data$groupTime23 <- NULL 
data$groupTime24 <- NULL 
data$groupTime25 <- NULL 
data$groupTime26 <- NULL 
data$groupTime27 <- NULL 
data$groupTime28 <- NULL 
data$groupTime29 <- NULL 
data$groupTime30 <- NULL 
data$groupTime31 <- NULL 
data$groupTime32 <- NULL 
data$groupTime33 <- NULL 
data$groupTime34 <- NULL 
data$groupTime35 <- NULL 
data$groupTime36 <- NULL 
data$groupTime37 <- NULL 
data$groupTime38 <- NULL 
data$groupTime39 <- NULL 
data$groupTime40 <- NULL 
data$groupTime41 <- NULL 
data$groupTime42 <- NULL 
data$groupTime43 <- NULL 
data$groupTime44 <- NULL 
data$groupTime45 <- NULL 
data$groupTime46 <- NULL 
data$groupTime47 <- NULL 
data$groupTime48 <- NULL 
```

Then we calculate the correct answers, the efficacy and the efficiency for each model
```{r calculate-correct-ans}
#str(iv)
# Calculate number of correct answers (max is 10 correct answers)
data$Model1a_Correct <- calc.correct(1,data$Model1Q1a, data$Model1Q2a, data$Model1Q3a, 
                                     data$Model1Q4a, data$Model1Q5a.SQ001, data$Model1Q5a.SQ002,
                                     data$Model1Q5a.SQ003, data$Model1Q5a.SQ004, 
                                     data$Model1Q5a.SQ005, data$Model1Q5a.SQ006,iv)
data$Model2a_Correct <- calc.correct(2,data$Model2Q1a, data$Model2Q2a, data$Model2Q3a, 
                                     data$Model2Q4a, data$Model2Q5a.SQ001, data$Model2Q5a.SQ002,
                                     data$Model2Q5a.SQ003, data$Model2Q5a.SQ004, 
                                     data$Model2Q5a.SQ005, data$Model2Q5a.SQ006,iv)
data$Model3a_Correct <- calc.correct(3,data$Model3Q1a, data$Model3Q2a, data$Model3Q3a, 
                                     data$Model3Q4a, data$Model3Q5a.SQ001, data$Model3Q5a.SQ002,
                                     data$Model3Q5a.SQ003, data$Model3Q5a.SQ004, 
                                     data$Model3Q5a.SQ005, data$Model3Q5a.SQ006,iv)
data$Model4a_Correct <- calc.correct(4,data$Model4Q1a, data$Model4Q2a, data$Model4Q3a, 
                                     data$Model4Q4a, data$Model4Q5a.SQ001, data$Model4Q5a.SQ002,
                                     data$Model4Q5a.SQ003, data$Model4Q5a.SQ004, 
                                     data$Model4Q5a.SQ005, data$Model4Q5a.SQ006,iv)
data$Model5a_Correct <- calc.correct(5,data$Model5Q1a, data$Model5Q2a, data$Model5Q3a, 
                                     data$Model5Q4a, data$Model5Q5a.SQ001, data$Model5Q5a.SQ002,
                                     data$Model5Q5a.SQ003, data$Model5Q5a.SQ004, 
                                     data$Model5Q5a.SQ005, data$Model5Q5a.SQ006,iv)

data$Model1b_Correct <- calc.correct(1,data$Model1Q1b, data$Model1Q2b, data$Model1Q3b, 
                                     data$Model1Q4b, data$Model1Q5b.SQ001, data$Model1Q5b.SQ002,
                                     data$Model1Q5b.SQ003, data$Model1Q5b.SQ004, 
                                     data$Model1Q5b.SQ005, data$Model1Q5b.SQ006,iv)
data$Model2b_Correct <- calc.correct(2,data$Model2Q1b, data$Model2Q2b, data$Model2Q3b, 
                                     data$Model2Q4b, data$Model2Q5b.SQ001, data$Model2Q5b.SQ002,
                                     data$Model2Q5b.SQ003, data$Model2Q5b.SQ004, 
                                     data$Model2Q5b.SQ005, data$Model2Q5b.SQ006,iv)
data$Model3b_Correct <- calc.correct(3,data$Model3Q1b, data$Model3Q2b, data$Model3Q3b, 
                                     data$Model3Q4b, data$Model3Q5b.SQ001, data$Model3Q5b.SQ002,
                                     data$Model3Q5b.SQ003, data$Model3Q5b.SQ004, 
                                     data$Model3Q5b.SQ005, data$Model3Q5b.SQ006,iv)
data$Model4b_Correct <- calc.correct(4,data$Model4Q1b, data$Model4Q2b, data$Model4Q3b, 
                                     data$Model4Q4b, data$Model4Q5b.SQ001, data$Model4Q5b.SQ002,
                                     data$Model4Q5b.SQ003, data$Model4Q5b.SQ004, 
                                     data$Model4Q5b.SQ005, data$Model4Q5b.SQ006,iv)
data$Model5b_Correct <- calc.correct(5,data$Model5Q1b, data$Model5Q2b, data$Model5Q3b, 
                                     data$Model5Q4b, data$Model5Q5b.SQ001, data$Model5Q5b.SQ002,
                                     data$Model5Q5b.SQ003, data$Model5Q5b.SQ004, 
                                     data$Model5Q5b.SQ005, data$Model5Q5b.SQ006,iv)

# There is no Model6b, so
data$Model6a_Correct <- calc.correct(6,data$Model6Q1a, data$Model6Q2a, data$Model6Q3a, 
                                     data$Model6Q4a, data$Model6Q5a.SQ001, data$Model6Q5a.SQ002,
                                     data$Model6Q5a.SQ003, data$Model6Q5a.SQ004, 
                                     data$Model6Q5a.SQ005, data$Model6Q5a.SQ006,iv)

#Now calculate Efficacy
data$Model1a_Efficacy <- calc.efficacy(1,data$Model1a.Time, data$Model1a_Correct)
data$Model2a_Efficacy <- calc.efficacy(2,data$Model2a.Time, data$Model2a_Correct)
data$Model3a_Efficacy <- calc.efficacy(3,data$Model3a.Time, data$Model3a_Correct)
data$Model4a_Efficacy <- calc.efficacy(4,data$Model4a.Time, data$Model4a_Correct)
data$Model5a_Efficacy <- calc.efficacy(5,data$Model5a.Time, data$Model5a_Correct)

data$Model1b_Efficacy <- calc.efficacy(1,data$Model1b.Time, data$Model1b_Correct)
data$Model2b_Efficacy <- calc.efficacy(2,data$Model2b.Time, data$Model2b_Correct)
data$Model3b_Efficacy <- calc.efficacy(3,data$Model3b.Time, data$Model3b_Correct)
data$Model4b_Efficacy <- calc.efficacy(4,data$Model4b.Time, data$Model4b_Correct)
data$Model5b_Efficacy <- calc.efficacy(5,data$Model5b.Time, data$Model5b_Correct)

# There is no Model6b, so_Correct)
data$Model6a_Efficacy <- calc.efficacy(6,data$Model6a.Time, data$Model6a_Correct)

#Now calculate Efficiency
data$Model1a_Efficiency <- calc.efficiency(1,data$Model1a.Time, data$Model1a_Correct)
data$Model2a_Efficiency <- calc.efficiency(2,data$Model2a.Time, data$Model2a_Correct)
data$Model3a_Efficiency <- calc.efficiency(3,data$Model3a.Time, data$Model3a_Correct)
data$Model4a_Efficiency <- calc.efficiency(4,data$Model4a.Time, data$Model4a_Correct)
data$Model5a_Efficiency <- calc.efficiency(5,data$Model5a.Time, data$Model5a_Correct)

data$Model1b_Efficiency <- calc.efficiency(1,data$Model1b.Time, data$Model1b_Correct)
data$Model2b_Efficiency <- calc.efficiency(2,data$Model2b.Time, data$Model2b_Correct)
data$Model3b_Efficiency <- calc.efficiency(3,data$Model3b.Time, data$Model3b_Correct)
data$Model4b_Efficiency <- calc.efficiency(4,data$Model4b.Time, data$Model4b_Correct)
data$Model5b_Efficiency <- calc.efficiency(5,data$Model5b.Time, data$Model5b_Correct)

# There is no Model6b
data$Model6a_Efficiency <- calc.efficiency(6,data$Model6a.Time, data$Model6a_Correct)

```
We now print a file with the calculations of raw correct, efficiency, efficacy
```{r generate-correct-files}
if(params$test) write.csv(subset(data, select = c(id, SetId, iv.A.name, iv.B.name, Model1Q1a, Model1Q1b,
 Model1Q2a, Model1Q2b, Model1Q3a, Model1Q3b, Model1Q4a, Model1Q4b, Model1Q5a.SQ001,
 Model1Q5a.SQ002, Model1Q5a.SQ003, Model1Q5a.SQ004, Model1Q5a.SQ005, Model1Q5a.SQ006,
 Model1Q5b.SQ001, Model1Q5b.SQ002, Model1Q5b.SQ003, Model1Q5b.SQ004, Model1Q5b.SQ005,
 Model1Q5b.SQ006, Model1a_Correct, Model1b_Correct, Model2Q1a, Model2Q1b, Model2Q2a,
 Model2Q2b, Model2Q3a, Model2Q3b, Model2Q4a, Model2Q4b, Model2Q5a.SQ001, Model2Q5a.SQ002,
 Model2Q5a.SQ003, Model2Q5a.SQ004, Model2Q5a.SQ005, Model2Q5a.SQ006, Model2Q5b.SQ001,
 Model2Q5b.SQ002, Model2Q5b.SQ003, Model2Q5b.SQ004, Model2Q5b.SQ005, Model2Q5b.SQ006,
 Model2a_Correct, Model2b_Correct, Model3Q1a, Model3Q1b, Model3Q2a, Model3Q2b, Model3Q3a,
 Model3Q3b, Model3Q4a, Model3Q4b, Model3Q5a.SQ001, Model3Q5a.SQ002, Model3Q5a.SQ003,
 Model3Q5a.SQ004, Model3Q5a.SQ005, Model3Q5a.SQ006, Model3Q5b.SQ001, Model3Q5b.SQ002,
 Model3Q5b.SQ003, Model3Q5b.SQ004, Model3Q5b.SQ005, Model3Q5b.SQ006, Model3a_Correct,
 Model3b_Correct, Model4Q1a, Model4Q1b, Model4Q2a, Model4Q2b, Model4Q3a, Model4Q3b,
 Model4Q4a, Model4Q4b, Model4Q5a.SQ001, Model4Q5a.SQ002, Model4Q5a.SQ003, Model4Q5a.SQ004,
 Model4Q5a.SQ005, Model4Q5a.SQ006, Model4Q5b.SQ001, Model4Q5b.SQ002, Model4Q5b.SQ003,
 Model4Q5b.SQ004, Model4Q5b.SQ005, Model4Q5b.SQ006, Model4a_Correct, Model4b_Correct,
 Model5Q1a, Model5Q1b, Model5Q2a, Model5Q2b, Model5Q3a, Model5Q3b, Model5Q4a, Model5Q4b,
 Model5Q5a.SQ001, Model5Q5a.SQ002, Model5Q5a.SQ003, Model5Q5a.SQ004, Model5Q5a.SQ005,
 Model5Q5a.SQ006, Model5Q5b.SQ001, Model5Q5b.SQ002, Model5Q5b.SQ003, Model5Q5b.SQ004,
 Model5Q5b.SQ005, Model5Q5b.SQ006, Model5a_Correct, Model5b_Correct, Model6Q1a, Model6Q2a,
 Model6Q3a, Model6Q4a, Model6Q5a.SQ001, Model6Q5a.SQ002, Model6Q5a.SQ003, Model6Q5a.SQ004,
 Model6Q5a.SQ005, Model6Q5a.SQ006, Model6a_Correct)),
 file = "out-raw-correct.csv",row.names=FALSE, na="")

if(params$test) write.csv(subset(data, select = c(id, SetId, iv.A.name, iv.B.name, Model1a_Efficacy,
 Model1a.Time, Model1a_Correct, Model2a_Efficacy, Model2a.Time, Model2a_Correct,
 Model3a_Efficacy, Model3a.Time, Model3a_Correct, Model4a_Efficacy, Model4a.Time,
 Model4a_Correct, Model5a_Efficacy, Model5a.Time, Model5a_Correct, Model1b_Efficacy,
 Model1b.Time, Model1b_Correct, Model2b_Efficacy, Model2b.Time, Model2b_Correct,
 Model3b_Efficacy, Model3b.Time, Model3b_Correct, Model4b_Efficacy, Model4b.Time,
 Model4b_Correct, Model5b_Efficacy, Model5b.Time, Model5b_Correct, Model6a_Efficacy,
 Model6a.Time, Model6a_Correct)), file = "out-raw-efficacy.csv",row.names=FALSE, na="")

if(params$test) write.csv(subset(data, select = c(id, SetId, iv.A.name, iv.B.name, Model1a_Efficiency,
 Model1a.Time, Model1a_Correct, Model2a_Efficiency, Model2a.Time, Model2a_Correct,
 Model3a_Efficiency, Model3a.Time, Model3a_Correct, Model4a_Efficiency, Model4a.Time,
 Model4a_Correct, Model5a_Efficiency, Model5a.Time, Model5a_Correct, Model1b_Efficiency,
 Model1b.Time, Model1b_Correct, Model2b_Efficiency, Model2b.Time, Model2b_Correct,
 Model3b_Efficiency, Model3b.Time, Model3b_Correct, Model4b_Efficiency, Model4b.Time,
 Model4b_Correct, Model5b_Efficiency, Model5b.Time, Model5b_Correct, Model6a_Efficiency,
 Model6a.Time, Model6a_Correct)), file = "out-raw-efficiency.csv",row.names=FALSE, na="")
```

###Consolidating correct answers, efficacy, and efficiency variables
We will consolidate the correct answers, efficacy, and efficiency variables that we just calculated.
Each subject is presented with two models, so we end with two observations of these three variables per row in the data set.
We will consolidate them into six variables as follows, A.Correct, A.Efficacy, A.Efficiency, B.Correct, B.Efficacy, B.Efficiency.

```{r consolidate}
# Create the variables
data$A.Correct <- NA
data$A.Time <- NA
data$A.Efficacy <- NA
data$A.Efficiency <- NA
data$B.Correct <- NA
data$B.Time <- NA
data$B.Efficacy <- NA
data$B.Efficiency <- NA

# Now let populate them
data$A.Correct[data$SetId==1] <- data$Model1a_Correct[data$SetId==1]
data$B.Correct[data$SetId==1] <- data$Model2a_Correct[data$SetId==1]
data$A.Correct[data$SetId==2] <- data$Model1a_Correct[data$SetId==2]
data$B.Correct[data$SetId==2] <- data$Model3a_Correct[data$SetId==2]
data$A.Correct[data$SetId==3] <- data$Model1a_Correct[data$SetId==3]
data$B.Correct[data$SetId==3] <- data$Model4a_Correct[data$SetId==3]
data$A.Correct[data$SetId==4] <- data$Model1a_Correct[data$SetId==4]
data$B.Correct[data$SetId==4] <- data$Model5a_Correct[data$SetId==4]
data$A.Correct[data$SetId==5] <- data$Model1a_Correct[data$SetId==5]
data$B.Correct[data$SetId==5] <- data$Model6a_Correct[data$SetId==5]
data$A.Correct[data$SetId==6] <- data$Model2a_Correct[data$SetId==6]
data$B.Correct[data$SetId==6] <- data$Model1b_Correct[data$SetId==6]
data$A.Correct[data$SetId==7] <- data$Model2a_Correct[data$SetId==7]
data$B.Correct[data$SetId==7] <- data$Model3a_Correct[data$SetId==7]
data$A.Correct[data$SetId==8] <- data$Model2a_Correct[data$SetId==8]
data$B.Correct[data$SetId==8] <- data$Model4a_Correct[data$SetId==8]
data$A.Correct[data$SetId==9] <- data$Model2a_Correct[data$SetId==9]
data$B.Correct[data$SetId==9] <- data$Model5a_Correct[data$SetId==9]
data$A.Correct[data$SetId==10] <- data$Model2a_Correct[data$SetId==10]
data$B.Correct[data$SetId==10] <- data$Model6a_Correct[data$SetId==10]
data$A.Correct[data$SetId==11] <- data$Model3a_Correct[data$SetId==11]
data$B.Correct[data$SetId==11] <- data$Model1b_Correct[data$SetId==11]
data$A.Correct[data$SetId==12] <- data$Model3a_Correct[data$SetId==12]
data$B.Correct[data$SetId==12] <- data$Model2b_Correct[data$SetId==12]
data$A.Correct[data$SetId==13] <- data$Model3a_Correct[data$SetId==13]
data$B.Correct[data$SetId==13] <- data$Model4a_Correct[data$SetId==13]
data$A.Correct[data$SetId==14] <- data$Model3a_Correct[data$SetId==14]
data$B.Correct[data$SetId==14] <- data$Model5a_Correct[data$SetId==14]
data$A.Correct[data$SetId==15] <- data$Model3a_Correct[data$SetId==15]
data$B.Correct[data$SetId==15] <- data$Model6a_Correct[data$SetId==15]
data$A.Correct[data$SetId==16] <- data$Model4a_Correct[data$SetId==16]
data$B.Correct[data$SetId==16] <- data$Model1b_Correct[data$SetId==16]
data$A.Correct[data$SetId==17] <- data$Model4a_Correct[data$SetId==17]
data$B.Correct[data$SetId==17] <- data$Model2b_Correct[data$SetId==17]
data$A.Correct[data$SetId==18] <- data$Model4a_Correct[data$SetId==18]
data$B.Correct[data$SetId==18] <- data$Model3b_Correct[data$SetId==18]
data$A.Correct[data$SetId==19] <- data$Model4a_Correct[data$SetId==19]
data$B.Correct[data$SetId==19] <- data$Model5a_Correct[data$SetId==19]
data$A.Correct[data$SetId==20] <- data$Model4a_Correct[data$SetId==20]
data$B.Correct[data$SetId==20] <- data$Model6a_Correct[data$SetId==20]
data$A.Correct[data$SetId==21] <- data$Model5a_Correct[data$SetId==21]
data$B.Correct[data$SetId==21] <- data$Model1b_Correct[data$SetId==21]
data$A.Correct[data$SetId==22] <- data$Model5a_Correct[data$SetId==22]
data$B.Correct[data$SetId==22] <- data$Model2b_Correct[data$SetId==22]
data$A.Correct[data$SetId==23] <- data$Model5a_Correct[data$SetId==23]
data$B.Correct[data$SetId==23] <- data$Model3b_Correct[data$SetId==23]
data$A.Correct[data$SetId==24] <- data$Model5a_Correct[data$SetId==24]
data$B.Correct[data$SetId==24] <- data$Model4b_Correct[data$SetId==24]
data$A.Correct[data$SetId==25] <- data$Model5a_Correct[data$SetId==25]
data$B.Correct[data$SetId==25] <- data$Model6a_Correct[data$SetId==25]
data$A.Correct[data$SetId==26] <- data$Model6a_Correct[data$SetId==26]
data$B.Correct[data$SetId==26] <- data$Model1b_Correct[data$SetId==26]
data$A.Correct[data$SetId==27] <- data$Model6a_Correct[data$SetId==27]
data$B.Correct[data$SetId==27] <- data$Model2b_Correct[data$SetId==27]
data$A.Correct[data$SetId==28] <- data$Model6a_Correct[data$SetId==28]
data$B.Correct[data$SetId==28] <- data$Model3b_Correct[data$SetId==28]
data$A.Correct[data$SetId==29] <- data$Model6a_Correct[data$SetId==29]
data$B.Correct[data$SetId==29] <- data$Model4b_Correct[data$SetId==29]
data$A.Correct[data$SetId==30] <- data$Model6a_Correct[data$SetId==30]
data$B.Correct[data$SetId==30] <- data$Model5b_Correct[data$SetId==30]

data$A.Time[data$SetId==1] <- data$Model1a.Time[data$SetId==1]
data$B.Time[data$SetId==1] <- data$Model2a.Time[data$SetId==1]
data$A.Time[data$SetId==2] <- data$Model1a.Time[data$SetId==2]
data$B.Time[data$SetId==2] <- data$Model3a.Time[data$SetId==2]
data$A.Time[data$SetId==3] <- data$Model1a.Time[data$SetId==3]
data$B.Time[data$SetId==3] <- data$Model4a.Time[data$SetId==3]
data$A.Time[data$SetId==4] <- data$Model1a.Time[data$SetId==4]
data$B.Time[data$SetId==4] <- data$Model5a.Time[data$SetId==4]
data$A.Time[data$SetId==5] <- data$Model1a.Time[data$SetId==5]
data$B.Time[data$SetId==5] <- data$Model6a.Time[data$SetId==5]
data$A.Time[data$SetId==6] <- data$Model2a.Time[data$SetId==6]
data$B.Time[data$SetId==6] <- data$Model1b.Time[data$SetId==6]
data$A.Time[data$SetId==7] <- data$Model2a.Time[data$SetId==7]
data$B.Time[data$SetId==7] <- data$Model3a.Time[data$SetId==7]
data$A.Time[data$SetId==8] <- data$Model2a.Time[data$SetId==8]
data$B.Time[data$SetId==8] <- data$Model4a.Time[data$SetId==8]
data$A.Time[data$SetId==9] <- data$Model2a.Time[data$SetId==9]
data$B.Time[data$SetId==9] <- data$Model5a.Time[data$SetId==9]
data$A.Time[data$SetId==10] <- data$Model2a.Time[data$SetId==10]
data$B.Time[data$SetId==10] <- data$Model6a.Time[data$SetId==10]
data$A.Time[data$SetId==11] <- data$Model3a.Time[data$SetId==11]
data$B.Time[data$SetId==11] <- data$Model1b.Time[data$SetId==11]
data$A.Time[data$SetId==12] <- data$Model3a.Time[data$SetId==12]
data$B.Time[data$SetId==12] <- data$Model2b.Time[data$SetId==12]
data$A.Time[data$SetId==13] <- data$Model3a.Time[data$SetId==13]
data$B.Time[data$SetId==13] <- data$Model4a.Time[data$SetId==13]
data$A.Time[data$SetId==14] <- data$Model3a.Time[data$SetId==14]
data$B.Time[data$SetId==14] <- data$Model5a.Time[data$SetId==14]
data$A.Time[data$SetId==15] <- data$Model3a.Time[data$SetId==15]
data$B.Time[data$SetId==15] <- data$Model6a.Time[data$SetId==15]
data$A.Time[data$SetId==16] <- data$Model4a.Time[data$SetId==16]
data$B.Time[data$SetId==16] <- data$Model1b.Time[data$SetId==16]
data$A.Time[data$SetId==17] <- data$Model4a.Time[data$SetId==17]
data$B.Time[data$SetId==17] <- data$Model2b.Time[data$SetId==17]
data$A.Time[data$SetId==18] <- data$Model4a.Time[data$SetId==18]
data$B.Time[data$SetId==18] <- data$Model3b.Time[data$SetId==18]
data$A.Time[data$SetId==19] <- data$Model4a.Time[data$SetId==19]
data$B.Time[data$SetId==19] <- data$Model5a.Time[data$SetId==19]
data$A.Time[data$SetId==20] <- data$Model4a.Time[data$SetId==20]
data$B.Time[data$SetId==20] <- data$Model6a.Time[data$SetId==20]
data$A.Time[data$SetId==21] <- data$Model5a.Time[data$SetId==21]
data$B.Time[data$SetId==21] <- data$Model1b.Time[data$SetId==21]
data$A.Time[data$SetId==22] <- data$Model5a.Time[data$SetId==22]
data$B.Time[data$SetId==22] <- data$Model2b.Time[data$SetId==22]
data$A.Time[data$SetId==23] <- data$Model5a.Time[data$SetId==23]
data$B.Time[data$SetId==23] <- data$Model3b.Time[data$SetId==23]
data$A.Time[data$SetId==24] <- data$Model5a.Time[data$SetId==24]
data$B.Time[data$SetId==24] <- data$Model4b.Time[data$SetId==24]
data$A.Time[data$SetId==25] <- data$Model5a.Time[data$SetId==25]
data$B.Time[data$SetId==25] <- data$Model6a.Time[data$SetId==25]
data$A.Time[data$SetId==26] <- data$Model6a.Time[data$SetId==26]
data$B.Time[data$SetId==26] <- data$Model1b.Time[data$SetId==26]
data$A.Time[data$SetId==27] <- data$Model6a.Time[data$SetId==27]
data$B.Time[data$SetId==27] <- data$Model2b.Time[data$SetId==27]
data$A.Time[data$SetId==28] <- data$Model6a.Time[data$SetId==28]
data$B.Time[data$SetId==28] <- data$Model3b.Time[data$SetId==28]
data$A.Time[data$SetId==29] <- data$Model6a.Time[data$SetId==29]
data$B.Time[data$SetId==29] <- data$Model4b.Time[data$SetId==29]
data$A.Time[data$SetId==30] <- data$Model6a.Time[data$SetId==30]
data$B.Time[data$SetId==30] <- data$Model5b.Time[data$SetId==30]

data$A.Efficacy[data$SetId==1] <- data$Model1a_Efficacy[data$SetId==1]
data$B.Efficacy[data$SetId==1] <- data$Model2a_Efficacy[data$SetId==1]
data$A.Efficacy[data$SetId==2] <- data$Model1a_Efficacy[data$SetId==2]
data$B.Efficacy[data$SetId==2] <- data$Model3a_Efficacy[data$SetId==2]
data$A.Efficacy[data$SetId==3] <- data$Model1a_Efficacy[data$SetId==3]
data$B.Efficacy[data$SetId==3] <- data$Model4a_Efficacy[data$SetId==3]
data$A.Efficacy[data$SetId==4] <- data$Model1a_Efficacy[data$SetId==4]
data$B.Efficacy[data$SetId==4] <- data$Model5a_Efficacy[data$SetId==4]
data$A.Efficacy[data$SetId==5] <- data$Model1a_Efficacy[data$SetId==5]
data$B.Efficacy[data$SetId==5] <- data$Model6a_Efficacy[data$SetId==5]
data$A.Efficacy[data$SetId==6] <- data$Model2a_Efficacy[data$SetId==6]
data$B.Efficacy[data$SetId==6] <- data$Model1b_Efficacy[data$SetId==6]
data$A.Efficacy[data$SetId==7] <- data$Model2a_Efficacy[data$SetId==7]
data$B.Efficacy[data$SetId==7] <- data$Model3a_Efficacy[data$SetId==7]
data$A.Efficacy[data$SetId==8] <- data$Model2a_Efficacy[data$SetId==8]
data$B.Efficacy[data$SetId==8] <- data$Model4a_Efficacy[data$SetId==8]
data$A.Efficacy[data$SetId==9] <- data$Model2a_Efficacy[data$SetId==9]
data$B.Efficacy[data$SetId==9] <- data$Model5a_Efficacy[data$SetId==9]
data$A.Efficacy[data$SetId==10] <- data$Model2a_Efficacy[data$SetId==10]
data$B.Efficacy[data$SetId==10] <- data$Model6a_Efficacy[data$SetId==10]
data$A.Efficacy[data$SetId==11] <- data$Model3a_Efficacy[data$SetId==11]
data$B.Efficacy[data$SetId==11] <- data$Model1b_Efficacy[data$SetId==11]
data$A.Efficacy[data$SetId==12] <- data$Model3a_Efficacy[data$SetId==12]
data$B.Efficacy[data$SetId==12] <- data$Model2b_Efficacy[data$SetId==12]
data$A.Efficacy[data$SetId==13] <- data$Model3a_Efficacy[data$SetId==13]
data$B.Efficacy[data$SetId==13] <- data$Model4a_Efficacy[data$SetId==13]
data$A.Efficacy[data$SetId==14] <- data$Model3a_Efficacy[data$SetId==14]
data$B.Efficacy[data$SetId==14] <- data$Model5a_Efficacy[data$SetId==14]
data$A.Efficacy[data$SetId==15] <- data$Model3a_Efficacy[data$SetId==15]
data$B.Efficacy[data$SetId==15] <- data$Model6a_Efficacy[data$SetId==15]
data$A.Efficacy[data$SetId==16] <- data$Model4a_Efficacy[data$SetId==16]
data$B.Efficacy[data$SetId==16] <- data$Model1b_Efficacy[data$SetId==16]
data$A.Efficacy[data$SetId==17] <- data$Model4a_Efficacy[data$SetId==17]
data$B.Efficacy[data$SetId==17] <- data$Model2b_Efficacy[data$SetId==17]
data$A.Efficacy[data$SetId==18] <- data$Model4a_Efficacy[data$SetId==18]
data$B.Efficacy[data$SetId==18] <- data$Model3b_Efficacy[data$SetId==18]
data$A.Efficacy[data$SetId==19] <- data$Model4a_Efficacy[data$SetId==19]
data$B.Efficacy[data$SetId==19] <- data$Model5a_Efficacy[data$SetId==19]
data$A.Efficacy[data$SetId==20] <- data$Model4a_Efficacy[data$SetId==20]
data$B.Efficacy[data$SetId==20] <- data$Model6a_Efficacy[data$SetId==20]
data$A.Efficacy[data$SetId==21] <- data$Model5a_Efficacy[data$SetId==21]
data$B.Efficacy[data$SetId==21] <- data$Model1b_Efficacy[data$SetId==21]
data$A.Efficacy[data$SetId==22] <- data$Model5a_Efficacy[data$SetId==22]
data$B.Efficacy[data$SetId==22] <- data$Model2b_Efficacy[data$SetId==22]
data$A.Efficacy[data$SetId==23] <- data$Model5a_Efficacy[data$SetId==23]
data$B.Efficacy[data$SetId==23] <- data$Model3b_Efficacy[data$SetId==23]
data$A.Efficacy[data$SetId==24] <- data$Model5a_Efficacy[data$SetId==24]
data$B.Efficacy[data$SetId==24] <- data$Model4b_Efficacy[data$SetId==24]
data$A.Efficacy[data$SetId==25] <- data$Model5a_Efficacy[data$SetId==25]
data$B.Efficacy[data$SetId==25] <- data$Model6a_Efficacy[data$SetId==25]
data$A.Efficacy[data$SetId==26] <- data$Model6a_Efficacy[data$SetId==26]
data$B.Efficacy[data$SetId==26] <- data$Model1b_Efficacy[data$SetId==26]
data$A.Efficacy[data$SetId==27] <- data$Model6a_Efficacy[data$SetId==27]
data$B.Efficacy[data$SetId==27] <- data$Model2b_Efficacy[data$SetId==27]
data$A.Efficacy[data$SetId==28] <- data$Model6a_Efficacy[data$SetId==28]
data$B.Efficacy[data$SetId==28] <- data$Model3b_Efficacy[data$SetId==28]
data$A.Efficacy[data$SetId==29] <- data$Model6a_Efficacy[data$SetId==29]
data$B.Efficacy[data$SetId==29] <- data$Model4b_Efficacy[data$SetId==29]
data$A.Efficacy[data$SetId==30] <- data$Model6a_Efficacy[data$SetId==30]
data$B.Efficacy[data$SetId==30] <- data$Model5b_Efficacy[data$SetId==30]

data$A.Efficiency[data$SetId==1] <- data$Model1a_Efficiency[data$SetId==1]
data$B.Efficiency[data$SetId==1] <- data$Model2a_Efficiency[data$SetId==1]
data$A.Efficiency[data$SetId==2] <- data$Model1a_Efficiency[data$SetId==2]
data$B.Efficiency[data$SetId==2] <- data$Model3a_Efficiency[data$SetId==2]
data$A.Efficiency[data$SetId==3] <- data$Model1a_Efficiency[data$SetId==3]
data$B.Efficiency[data$SetId==3] <- data$Model4a_Efficiency[data$SetId==3]
data$A.Efficiency[data$SetId==4] <- data$Model1a_Efficiency[data$SetId==4]
data$B.Efficiency[data$SetId==4] <- data$Model5a_Efficiency[data$SetId==4]
data$A.Efficiency[data$SetId==5] <- data$Model1a_Efficiency[data$SetId==5]
data$B.Efficiency[data$SetId==5] <- data$Model6a_Efficiency[data$SetId==5]
data$A.Efficiency[data$SetId==6] <- data$Model2a_Efficiency[data$SetId==6]
data$B.Efficiency[data$SetId==6] <- data$Model1b_Efficiency[data$SetId==6]
data$A.Efficiency[data$SetId==7] <- data$Model2a_Efficiency[data$SetId==7]
data$B.Efficiency[data$SetId==7] <- data$Model3a_Efficiency[data$SetId==7]
data$A.Efficiency[data$SetId==8] <- data$Model2a_Efficiency[data$SetId==8]
data$B.Efficiency[data$SetId==8] <- data$Model4a_Efficiency[data$SetId==8]
data$A.Efficiency[data$SetId==9] <- data$Model2a_Efficiency[data$SetId==9]
data$B.Efficiency[data$SetId==9] <- data$Model5a_Efficiency[data$SetId==9]
data$A.Efficiency[data$SetId==10] <- data$Model2a_Efficiency[data$SetId==10]
data$B.Efficiency[data$SetId==10] <- data$Model6a_Efficiency[data$SetId==10]
data$A.Efficiency[data$SetId==11] <- data$Model3a_Efficiency[data$SetId==11]
data$B.Efficiency[data$SetId==11] <- data$Model1b_Efficiency[data$SetId==11]
data$A.Efficiency[data$SetId==12] <- data$Model3a_Efficiency[data$SetId==12]
data$B.Efficiency[data$SetId==12] <- data$Model2b_Efficiency[data$SetId==12]
data$A.Efficiency[data$SetId==13] <- data$Model3a_Efficiency[data$SetId==13]
data$B.Efficiency[data$SetId==13] <- data$Model4a_Efficiency[data$SetId==13]
data$A.Efficiency[data$SetId==14] <- data$Model3a_Efficiency[data$SetId==14]
data$B.Efficiency[data$SetId==14] <- data$Model5a_Efficiency[data$SetId==14]
data$A.Efficiency[data$SetId==15] <- data$Model3a_Efficiency[data$SetId==15]
data$B.Efficiency[data$SetId==15] <- data$Model6a_Efficiency[data$SetId==15]
data$A.Efficiency[data$SetId==16] <- data$Model4a_Efficiency[data$SetId==16]
data$B.Efficiency[data$SetId==16] <- data$Model1b_Efficiency[data$SetId==16]
data$A.Efficiency[data$SetId==17] <- data$Model4a_Efficiency[data$SetId==17]
data$B.Efficiency[data$SetId==17] <- data$Model2b_Efficiency[data$SetId==17]
data$A.Efficiency[data$SetId==18] <- data$Model4a_Efficiency[data$SetId==18]
data$B.Efficiency[data$SetId==18] <- data$Model3b_Efficiency[data$SetId==18]
data$A.Efficiency[data$SetId==19] <- data$Model4a_Efficiency[data$SetId==19]
data$B.Efficiency[data$SetId==19] <- data$Model5a_Efficiency[data$SetId==19]
data$A.Efficiency[data$SetId==20] <- data$Model4a_Efficiency[data$SetId==20]
data$B.Efficiency[data$SetId==20] <- data$Model6a_Efficiency[data$SetId==20]
data$A.Efficiency[data$SetId==21] <- data$Model5a_Efficiency[data$SetId==21]
data$B.Efficiency[data$SetId==21] <- data$Model1b_Efficiency[data$SetId==21]
data$A.Efficiency[data$SetId==22] <- data$Model5a_Efficiency[data$SetId==22]
data$B.Efficiency[data$SetId==22] <- data$Model2b_Efficiency[data$SetId==22]
data$A.Efficiency[data$SetId==23] <- data$Model5a_Efficiency[data$SetId==23]
data$B.Efficiency[data$SetId==23] <- data$Model3b_Efficiency[data$SetId==23]
data$A.Efficiency[data$SetId==24] <- data$Model5a_Efficiency[data$SetId==24]
data$B.Efficiency[data$SetId==24] <- data$Model4b_Efficiency[data$SetId==24]
data$A.Efficiency[data$SetId==25] <- data$Model5a_Efficiency[data$SetId==25]
data$B.Efficiency[data$SetId==25] <- data$Model6a_Efficiency[data$SetId==25]
data$A.Efficiency[data$SetId==26] <- data$Model6a_Efficiency[data$SetId==26]
data$B.Efficiency[data$SetId==26] <- data$Model1b_Efficiency[data$SetId==26]
data$A.Efficiency[data$SetId==27] <- data$Model6a_Efficiency[data$SetId==27]
data$B.Efficiency[data$SetId==27] <- data$Model2b_Efficiency[data$SetId==27]
data$A.Efficiency[data$SetId==28] <- data$Model6a_Efficiency[data$SetId==28]
data$B.Efficiency[data$SetId==28] <- data$Model3b_Efficiency[data$SetId==28]
data$A.Efficiency[data$SetId==29] <- data$Model6a_Efficiency[data$SetId==29]
data$B.Efficiency[data$SetId==29] <- data$Model4b_Efficiency[data$SetId==29]
data$A.Efficiency[data$SetId==30] <- data$Model6a_Efficiency[data$SetId==30]
data$B.Efficiency[data$SetId==30] <- data$Model5b_Efficiency[data$SetId==30]
```

We now print a file with the calculations of correct, efficiency, and efficacy
```{r generate-more-files}
if(params$test) write.csv(subset(data, select = c(id, SetId, iv.A.name, iv.B.name, A.Correct, A.Time,
 Model1a.Time, Model1a_Correct, Model2a.Time, Model2a_Correct, Model3a.Time,
 Model3a_Correct, Model4a.Time, Model4a_Correct, Model5a.Time, Model5a_Correct,
 Model6a.Time, Model6a_Correct, B.Correct, B.Time, Model1b.Time, Model1b_Correct,
 Model2b.Time, Model2b_Correct, Model3b.Time, Model3b_Correct, Model4b.Time,
 Model4b_Correct, Model5b.Time, Model5b_Correct)),
 file = "out-correct.csv",row.names=FALSE, na="")

if(params$test) write.csv(subset(data, select = c(id, SetId, iv.A.name, iv.B.name, A.Efficacy, A.Time,
 Model1a.Time, Model1a_Efficacy, Model2a.Time, Model2a_Efficacy, Model3a.Time,
 Model3a_Efficacy, Model4a.Time, Model4a_Efficacy, Model5a.Time, Model5a_Efficacy,
 Model6a.Time, Model6a_Efficacy, B.Efficacy, B.Time, Model1b.Time, Model1b_Efficacy,
 Model2b.Time, Model2b_Efficacy, Model3b.Time, Model3b_Efficacy, Model4b.Time,
 Model4b_Efficacy, Model5b.Time, Model5b_Efficacy)),
 file = "out-efficacy.csv",row.names=FALSE, na="")

if(params$test) write.csv(subset(data, select = c(id, SetId, iv.A.name, iv.B.name, A.Efficiency, A.Time,
 Model1a.Time, Model1a_Efficiency, Model2a.Time, Model2a_Efficiency, Model3a.Time,
 Model3a_Efficiency, Model4a.Time, Model4a_Efficiency, Model5a.Time, Model5a_Efficiency,
 Model6a.Time, Model6a_Efficiency, B.Efficiency, B.Time, Model1b.Time, Model1b_Efficiency,
 Model2b.Time, Model2b_Efficiency, Model3b.Time, Model3b_Efficiency, Model4b.Time,
 Model4b_Efficiency, Model5b.Time, Model5b_Efficiency)),
 file = "out-efficiency.csv",row.names=FALSE, na="")
```
##Removing columns that are not needed anymore
This block will drop the data that is not needed after the calculations
```{r not-needed}
data$Model1Q1a <- NULL
data$Model1Q2a <- NULL
data$Model1Q3a <- NULL
data$Model1Q4a <- NULL
data$Model1Q5a.SQ001 <- NULL
data$Model1Q5a.SQ002 <- NULL
data$Model1Q5a.SQ003 <- NULL
data$Model1Q5a.SQ004 <- NULL
data$Model1Q5a.SQ005 <- NULL
data$Model1Q5a.SQ006 <- NULL
data$Perceived1a.ans <- NULL
data$Model2Q1a <- NULL
data$Model2Q2a <- NULL
data$Model2Q3a <- NULL
data$Model2Q4a <- NULL
data$Model2Q5a.SQ001 <- NULL
data$Model2Q5a.SQ002 <- NULL
data$Model2Q5a.SQ003 <- NULL
data$Model2Q5a.SQ004 <- NULL
data$Model2Q5a.SQ005 <- NULL
data$Model2Q5a.SQ006 <- NULL
data$Perceived2a.ans <- NULL
data$Model3Q1a <- NULL
data$Model3Q2a <- NULL
data$Model3Q3a <- NULL
data$Model3Q4a <- NULL
data$Model3Q5a.SQ001 <- NULL
data$Model3Q5a.SQ002 <- NULL
data$Model3Q5a.SQ003 <- NULL
data$Model3Q5a.SQ004 <- NULL
data$Model3Q5a.SQ005 <- NULL
data$Model3Q5a.SQ006 <- NULL
data$Perceived3a.ans <- NULL
data$Model4Q1a <- NULL
data$Model4Q2a <- NULL
data$Model4Q3a <- NULL
data$Model4Q4a <- NULL
data$Model4Q5a.SQ001 <- NULL
data$Model4Q5a.SQ002 <- NULL
data$Model4Q5a.SQ003 <- NULL
data$Model4Q5a.SQ004 <- NULL
data$Model4Q5a.SQ005 <- NULL
data$Model4Q5a.SQ006 <- NULL
data$Perceived4a.ans <- NULL
data$Model5Q1a <- NULL
data$Model5Q2a <- NULL
data$Model5Q3a <- NULL
data$Model5Q4a <- NULL
data$Model5Q5a.SQ001 <- NULL
data$Model5Q5a.SQ002 <- NULL
data$Model5Q5a.SQ003 <- NULL
data$Model5Q5a.SQ004 <- NULL
data$Model5Q5a.SQ005 <- NULL
data$Model5Q5a.SQ006 <- NULL
data$Perceived5a.ans <- NULL
data$Model6Q1a <- NULL
data$Model6Q2a <- NULL
data$Model6Q3a <- NULL
data$Model6Q4a <- NULL
data$Model6Q5a.SQ001 <- NULL
data$Model6Q5a.SQ002 <- NULL
data$Model6Q5a.SQ003 <- NULL
data$Model6Q5a.SQ004 <- NULL
data$Model6Q5a.SQ005 <- NULL
data$Model6Q5a.SQ006 <- NULL
data$Perceived6a.ans <- NULL
data$Model1Q1b <- NULL
data$Model1Q2b <- NULL
data$Model1Q3b <- NULL
data$Model1Q4b <- NULL
data$Model1Q5b.SQ001 <- NULL
data$Model1Q5b.SQ002 <- NULL
data$Model1Q5b.SQ003 <- NULL
data$Model1Q5b.SQ004 <- NULL
data$Model1Q5b.SQ005 <- NULL
data$Model1Q5b.SQ006 <- NULL
data$Perceived1b.ans <- NULL
data$Model2Q1b <- NULL
data$Model2Q2b <- NULL
data$Model2Q3b <- NULL
data$Model2Q4b <- NULL
data$Model2Q5b.SQ001 <- NULL
data$Model2Q5b.SQ002 <- NULL
data$Model2Q5b.SQ003 <- NULL
data$Model2Q5b.SQ004 <- NULL
data$Model2Q5b.SQ005 <- NULL
data$Model2Q5b.SQ006 <- NULL
data$Perceived2b.ans <- NULL
data$Model3Q1b <- NULL
data$Model3Q2b <- NULL
data$Model3Q3b <- NULL
data$Model3Q4b <- NULL
data$Model3Q5b.SQ001 <- NULL
data$Model3Q5b.SQ002 <- NULL
data$Model3Q5b.SQ003 <- NULL
data$Model3Q5b.SQ004 <- NULL
data$Model3Q5b.SQ005 <- NULL
data$Model3Q5b.SQ006 <- NULL
data$Perceived3b.ans <- NULL
data$Model4Q1b <- NULL
data$Model4Q2b <- NULL
data$Model4Q3b <- NULL
data$Model4Q4b <- NULL
data$Model4Q5b.SQ001 <- NULL
data$Model4Q5b.SQ002 <- NULL
data$Model4Q5b.SQ003 <- NULL
data$Model4Q5b.SQ004 <- NULL
data$Model4Q5b.SQ005 <- NULL
data$Model4Q5b.SQ006 <- NULL
data$Perceived4b.ans <- NULL
data$Model5Q1b <- NULL
data$Model5Q2b <- NULL
data$Model5Q3b <- NULL
data$Model5Q4b <- NULL
data$Model5Q5b.SQ001 <- NULL
data$Model5Q5b.SQ002 <- NULL
data$Model5Q5b.SQ003 <- NULL
data$Model5Q5b.SQ004 <- NULL
data$Model5Q5b.SQ005 <- NULL
data$Model5Q5b.SQ006 <- NULL
data$Perceived5b.ans <- NULL
data$Compare1vs2.ans <- NULL
data$Compare1vs3.ans <- NULL
data$Compare1vs4.ans <- NULL
data$Compare1vs5.ans <- NULL
data$Compare1vs6.ans <- NULL
data$Compare2vs1.ans <- NULL
data$Compare2vs3.ans <- NULL
data$Compare2vs4.ans <- NULL
data$Compare2vs5.ans <- NULL
data$Compare2vs6.ans <- NULL
data$Compare3vs1.ans <- NULL
data$Compare3vs2.ans <- NULL
data$Compare3vs4.ans <- NULL
data$Compare3vs5.ans <- NULL
data$Compare3vs6.ans <- NULL
data$Compare4vs1.ans <- NULL
data$Compare4vs2.ans <- NULL
data$Compare4vs3.ans <- NULL
data$Compare4vs5.ans <- NULL
data$Compare4vs6.ans <- NULL
data$Compare5vs1.ans <- NULL
data$Compare5vs2.ans <- NULL
data$Compare5vs3.ans <- NULL
data$Compare5vs4.ans <- NULL
data$Compare5vs6.ans <- NULL
data$Compare6vs1.ans <- NULL
data$Compare6vs2.ans <- NULL
data$Compare6vs3.ans <- NULL
data$Compare6vs4.ans <- NULL
data$Compare6vs5.ans <- NULL
data$Model1a_Correct <- NULL
data$Model2a_Correct <- NULL
data$Model3a_Correct <- NULL
data$Model4a_Correct <- NULL
data$Model5a_Correct <- NULL
data$Model6a_Correct <- NULL
data$Model1b_Correct <- NULL
data$Model2b_Correct <- NULL
data$Model3b_Correct <- NULL
data$Model4b_Correct <- NULL
data$Model5b_Correct <- NULL
data$Model1a_Efficacy <- NULL
data$Model2a_Efficacy <- NULL
data$Model3a_Efficacy <- NULL
data$Model4a_Efficacy <- NULL
data$Model5a_Efficacy <- NULL
data$Model6a_Efficacy <- NULL
data$Model1b_Efficacy <- NULL
data$Model2b_Efficacy <- NULL
data$Model3b_Efficacy <- NULL
data$Model4b_Efficacy <- NULL
data$Model5b_Efficacy <- NULL
data$Model1a_Efficiency <- NULL
data$Model2a_Efficiency <- NULL
data$Model3a_Efficiency <- NULL
data$Model4a_Efficiency <- NULL
data$Model5a_Efficiency <- NULL
data$Model6a_Efficiency <- NULL
data$Model1b_Efficiency <- NULL
data$Model2b_Efficiency <- NULL
data$Model3b_Efficiency <- NULL
data$Model4b_Efficiency <- NULL
data$Model5b_Efficiency <- NULL
data$Model1a.Time <- NULL
data$Model2a.Time <- NULL
data$Model3a.Time  <- NULL
data$Model4a.Time  <- NULL
data$Model5a.Time  <- NULL
data$Model6a.Time  <- NULL
data$Model1b.Time  <- NULL
data$Model2b.Time  <- NULL
data$Model3b.Time  <- NULL
data$Model4b.Time  <- NULL
data$Model5b.Time <- NULL

data$model2vs1 <- NULL
data$model3vs1 <- NULL
data$model4vs1 <- NULL
data$model5vs1 <- NULL
data$model6vs1 <- NULL
data$model3vs2 <- NULL
data$model4vs2 <- NULL
data$model5vs2 <- NULL
data$model6vs2 <- NULL
data$model4vs3 <- NULL
data$model5vs3 <- NULL
data$model6vs3 <- NULL
data$model5vs4 <- NULL
data$model6vs4 <- NULL
data$model6vs5 <- NULL
data$EarlyAccess <- NULL
data$EarlyAccessTime <- NULL
data$RoleTime <- NULL
data$BiasTime <- NULL
data$WeightsTime <- NULL
data$CharityTime <- NULL

```

## Clean up and last minute variables

```{r Clean-up}

#Change the name of SetId to iv.Group
names(data)[names(data) == 'SetId'] <- 'iv.Group'

# Count the number of role answers per subject
data$Role.count <- 0
data$Role.count[!is.na(data$Role.R1)] <- 1
data$Role.count[!is.na(data$Role.R2)] <- data$Role.count[!is.na(data$Role.R2)] + 1
data$Role.count[!is.na(data$Role.R3)] <- data$Role.count[!is.na(data$Role.R3)] + 1
data$Role.count[!is.na(data$Role.R4)] <- data$Role.count[!is.na(data$Role.R4)] + 1
data$Role.count[!is.na(data$Role.R5)] <- data$Role.count[!is.na(data$Role.R5)] + 1
data$Role.count[!is.na(data$Role.R6)] <- data$Role.count[!is.na(data$Role.R6)] + 1
data$Role.count[!is.na(data$Role.R7)] <- data$Role.count[!is.na(data$Role.R7)] + 1
data$Role.count[!is.na(data$Role.R8)] <- data$Role.count[!is.na(data$Role.R8)] + 1
data$Role.count[!is.na(data$Role.R9)] <- data$Role.count[!is.na(data$Role.R9)] + 1
data$Role.count[!is.na(data$Role.R10)] <- data$Role.count[!is.na(data$Role.R10)] + 1
data$Role.count[!is.na(data$Role.other)] <- data$Role.count[!is.na(data$Role.other)] + 1
data$Role.count[data$Role.count==0] <- NA

# Count the number of bias answers per subject
data$Bias.count <- 0
data$Bias.count[!is.na(data$Bias.B1)] <- 1
data$Bias.count[!is.na(data$Bias.B2)] <- data$Bias.count[!is.na(data$Bias.B2)] + 1
data$Bias.count[!is.na(data$Bias.B3)] <- data$Bias.count[!is.na(data$Bias.B3)] + 1
data$Bias.count[!is.na(data$Bias.B4)] <- data$Bias.count[!is.na(data$Bias.B4)] + 1
data$Bias.count[!is.na(data$Bias.B5)] <- data$Bias.count[!is.na(data$Bias.B5)] + 1
data$Bias.count[!is.na(data$Bias.B6)] <- data$Bias.count[!is.na(data$Bias.B6)] + 1
data$Bias.count[!is.na(data$Bias.B7)] <- data$Bias.count[!is.na(data$Bias.B7)] + 1
data$Bias.count[!is.na(data$Bias.B8)] <- data$Bias.count[!is.na(data$Bias.B8)] + 1
data$Bias.count[!is.na(data$Bias.B9)] <- data$Bias.count[!is.na(data$Bias.B9)] + 1
data$Bias.count[!is.na(data$Bias.B10)] <- data$Bias.count[!is.na(data$Bias.B10)] + 1
data$Bias.count[!is.na(data$Bias.other)] <- data$Bias.count[!is.na(data$Bias.other)] + 1
data$Bias.count[data$Bias.count==0] <- NA

# Count the number of notation answers per subject
data$Notation.count <- 0
data$Notation.count[!is.na(data$Notation.None)] <- 1
data$Notation.count[!is.na(data$Notation.BPMN)] <- data$Notation.count[!is.na(data$Notation.BPMN)] + 1
data$Notation.count[!is.na(data$Notation.EPC)] <- data$Notation.count[!is.na(data$Notation.EPC)] + 1
data$Notation.count[!is.na(data$Notation.UMLAD)] <- data$Notation.count[!is.na(data$Notation.UMLAD)] + 1
data$Notation.count[!is.na(data$Notation.UML)] <- data$Notation.count[!is.na(data$Notation.UML)] + 1
data$Notation.count[!is.na(data$Notation.CMMN)] <- data$Notation.count[!is.na(data$Notation.CMMN)] + 1
data$Notation.count[!is.na(data$Notation.other)] <- data$Notation.count[!is.na(data$Notation.other)] + 1
data$Notation.count[data$Notation.count==0] <- NA

# Count the number of weights answers per subject
data$Weights.count <- 0
data$Weights.count[!is.na(data$Weights.AComplete)] <- 1
data$Weights.count[!is.na(data$Weights.BHTask)] <- data$Weights.count[!is.na(data$Weights.BHTask)] + 1
data$Weights.count[!is.na(data$Weights.CFileItem)] <- data$Weights.count[!is.na(data$Weights.CFileItem)] + 1
data$Weights.count[!is.na(data$Weights.CPlanningT)] <- data$Weights.count[!is.na(data$Weights.CPlanningT)] + 1
data$Weights.count[!is.na(data$Weights.CasePlan)] <- data$Weights.count[!is.na(data$Weights.CasePlan)] + 1
data$Weights.count[!is.na(data$Weights.CaseTask)] <- data$Weights.count[!is.na(data$Weights.CaseTask)] + 1
data$Weights.count[!is.na(data$Weights.CaseTasknim)] <- data$Weights.count[!is.na(data$Weights.CaseTasknim)] + 1
data$Weights.count[!is.na(data$Weights.Collapsed)] <- data$Weights.count[!is.na(data$Weights.Collapsed)] + 1
data$Weights.count[!is.na(data$Weights.Connector)] <- data$Weights.count[!is.na(data$Weights.Connector)] + 1
data$Weights.count[!is.na(data$Weights.DStage)] <- data$Weights.count[!is.na(data$Weights.DStage)] + 1
data$Weights.count[!is.na(data$Weights.DTask)] <- data$Weights.count[!is.na(data$Weights.DTask)] + 1
data$Weights.count[!is.na(data$Weights.EPlanningT)] <- data$Weights.count[!is.na(data$Weights.EPlanningT)] + 1
data$Weights.count[!is.na(data$Weights.EntryCrit)] <- data$Weights.count[!is.na(data$Weights.EntryCrit)] + 1
data$Weights.count[!is.na(data$Weights.EntryCritAND)] <- data$Weights.count[!is.na(data$Weights.EntryCritAND)] + 1
data$Weights.count[!is.na(data$Weights.EntryCritOR)] <- data$Weights.count[!is.na(data$Weights.EntryCritOR)] + 1
data$Weights.count[!is.na(data$Weights.EntryCritWC)] <- data$Weights.count[!is.na(data$Weights.EntryCritWC)] + 1
data$Weights.count[!is.na(data$Weights.Event)] <- data$Weights.count[!is.na(data$Weights.Event)] + 1
data$Weights.count[!is.na(data$Weights.ExitCrit)] <- data$Weights.count[!is.na(data$Weights.ExitCrit)] + 1
data$Weights.count[!is.na(data$Weights.ExitCritAND)] <- data$Weights.count[!is.na(data$Weights.ExitCritAND)] + 1
data$Weights.count[!is.na(data$Weights.ExitCritOR)] <- data$Weights.count[!is.na(data$Weights.ExitCritOR)] + 1
data$Weights.count[!is.na(data$Weights.ExitCritWC)] <- data$Weights.count[!is.na(data$Weights.ExitCritWC)] + 1
data$Weights.count[!is.na(data$Weights.Expanded)] <- data$Weights.count[!is.na(data$Weights.Expanded)] + 1
data$Weights.count[!is.na(data$Weights.HumanIcon)] <- data$Weights.count[!is.na(data$Weights.HumanIcon)] + 1
data$Weights.count[!is.na(data$Weights.ManualA)] <- data$Weights.count[!is.na(data$Weights.ManualA)] + 1
data$Weights.count[!is.na(data$Weights.Milestone)] <- data$Weights.count[!is.na(data$Weights.Milestone)] + 1
data$Weights.count[!is.na(data$Weights.NBHTask)] <- data$Weights.count[!is.na(data$Weights.NBHTask)] + 1
data$Weights.count[!is.na(data$Weights.PlanFrag)] <- data$Weights.count[!is.na(data$Weights.PlanFrag)] + 1
data$Weights.count[!is.na(data$Weights.ProcTask)] <- data$Weights.count[!is.na(data$Weights.ProcTask)] + 1
data$Weights.count[!is.na(data$Weights.Repetition)] <- data$Weights.count[!is.na(data$Weights.Repetition)] + 1
data$Weights.count[!is.na(data$Weights.Required)] <- data$Weights.count[!is.na(data$Weights.Required)] + 1
data$Weights.count[!is.na(data$Weights.Stage)] <- data$Weights.count[!is.na(data$Weights.Stage)] + 1
data$Weights.count[!is.na(data$Weights.Task)] <- data$Weights.count[!is.na(data$Weights.Task)] + 1
data$Weights.count[!is.na(data$Weights.TimerEvent)] <- data$Weights.count[!is.na(data$Weights.TimerEvent)] + 1
data$Weights.count[!is.na(data$Weights.UserEvent)] <- data$Weights.count[!is.na(data$Weights.UserEvent)] + 1
data$Weights.count[data$Weights.count==0] <- NA

## Identify rows that have data for at least one experiment 
## (this includes all completed and partially completed surveys)
data$experiment.count <- 0
data$experiment.count[!is.na(data$A.Correct)]   <- 1
data$experiment.count[!is.na(data$B.Correct)]   <- data$experiment.count[!is.na(data$B.Correct)] + 1
data$experiment.count[!is.na(data$A.perceived)] <- data$experiment.count[!is.na(data$A.perceived)] + 1
data$experiment.count[!is.na(data$B.perceived)] <- data$experiment.count[!is.na(data$B.perceived)] + 1
data$experiment.count[!is.na(data$C.Compare)]   <- data$experiment.count[!is.na(data$C.Compare)] + 1
data$experiment.count[!is.na(data$Weights.count)] <- data$experiment.count[!is.na(data$Weights.count)] + 1
data$experiment.count[data$experiment.count==0] <- NA
sum(!is.na(data$experiment.count))

## Calculate Survey.Time (= total.time - tutorial.time - concent.time)
data$Tutorial.Time[data$Tutorial==2] <- 0
data$tot.tmp <- data$Total.Time
data$tot.tmp[is.na(data$tot.tmp)] <- 0
data$tut.tmp <- data$Tutorial.Time
data$tut.tmp[is.na(data$tut.tmp)] <- 0
data$cnt.tmp <- data$Concent.Time
data$cnt.tmp[is.na(data$cnt.tmp)] <- 0
data$Survey.Time <- data$tot.tmp - data$tut.tmp - data$cnt.tmp
data$Survey.Time[data$Survey.Time <= 0] <- NA
data$Total.Time[data$Total.Time==0] <- NA

data$tut.tmp <- NULL ## Remove temporary variables
data$tot.tmp <- NULL
data$cnt.tmp <- NULL

# Notation experience
data$notation.experience <- 0
# Let calculate "tra.tmp > 0" that will indicate a subject with training or work experience in notations
data$tra.tmp <- data$Training
data$tra.tmp[is.na(data$Training)] <- 0
data$wrk.tmp <- data$Work
data$wrk.tmp[is.na(data$Work)] <- 0
data$tra.tmp <- data$tra.tmp + data$wrk.tmp 
data$wrk.tmp <- NULL
# Now let calculate "not.tmp > 0" that will indicate a subject that is using at least one notation
data$not.tmp <- data$Notation.count
data$not.tmp[is.na(data$Notation.count)] <- 0
data$non.tmp <- data$Notation.None
data$non.tmp[is.na(data$Notation.None)] <- 0
data$not.tmp <- data$not.tmp - data$non.tmp 
data$non.tmp <- NULL
data$cmmn.tmp <- data$Notation.CMMN
data$cmmn.tmp[is.na(data$Notation.CMMN)] <- 0
# Now let calculate the notation experience
# Use following table:
#     Work or training | Notation       
#     (data$tra.tmp)   | (data$not.tmp)        | Value of Notation experience
#     -----------------+-----------------------+-----
#            0         |     0                  1- No notation experience at all [bad]
#            1         |     0                  2- Not using a notation but has training or experience
#            0         |     1 - but no CMMN    3- uses a notation without training or experience
#            1         |     1 - but no CMMN    4- Uses at least one notation and has training or experience
#            0         |     1 + CMMN           5- Uses CMMN without training or experience
#            1         |     1 + CMMN           6- Uses CMMN plus training or experience
#
# THIS IS REALLY BAD< but I don't find any other god way to do this (ifelse() did not worked for this)
data$notation.experience <- 0
for (i in 1:nrow(data))
{
  if((data[i,"tra.tmp"] == 0) && (data[i,"not.tmp"] == 0)             ) data[i,"notation.experience"] <- 1
  if((data[i,"tra.tmp"] >  0) && (data[i,"not.tmp"] == 0)             ) data[i,"notation.experience"] <- 2
  if((data[i,"tra.tmp"] == 0) && (data[i,"not.tmp"] >  0)             ) data[i,"notation.experience"] <- 3
  if((data[i,"tra.tmp"] >  0) && (data[i,"not.tmp"] >  0)             ) data[i,"notation.experience"] <- 4
  if((data[i,"notation.experience"] == 3) && (data[i,"cmmn.tmp"] == 1)) data[i,"notation.experience"] <- 5
  if((data[i,"notation.experience"] == 4) && (data[i,"cmmn.tmp"] == 1)) data[i,"notation.experience"] <- 6
}
#print(data$notation.experience)

# To be considered a valid observation, the subjects must have completed more than one experiment
data$valid.row <- NA
data$valid.row[data$experiment.count>1] <- 1 # Must have answered more than one experiment to be considered valid

### Let fix the last page variable.
# Pages (or groups) in the survey were presented to the subjects as follows:
# Page (range)  Page name
#   1    (1)    Informed concent
#   2    (2)    Demographics and prior experience
#   3    (3)    Tutorial
#   4   (4-9)   Model A (both comprehension and perceived complexity questions)
#   5  (10-14)  Model A (both comprehension and perceived complexity questions)
#   6  (15-44)  Compare the two models
#   7   (45)    CMMN Notation
#   8   (46)    Final page
# Note that range is the LimeSurvey lastpage variable value (which we are going to recode)
data$lastpage <- recode(data$lastpage, "4:9=4; 10:14=5; 15:44=6; 45=7; 46=8" )


```


# Generate the output file
After we have done all the enhancement needed to the data set, let generate a coma separated file for further processing by other scripts.
The file will contain a clean data set with a row per subject.
Note that we keep all the subjects, even those that did not provided any useful data.
This is done so that *CMMN-Sample.Rmd* and *CMMN-basic-stats.Rmd* scripts can see all the data (useful or not).
However, that requires that ever script that wants to calculate statistics must filter the data-set by doing:
\begin{verbatim}
data <- subset(data,!is.na(data$valid.row))
\end{verbatim}
The output file is called *dataset-all.csv*, and must be used by all the scripts calculating statistics.
```{r output-file}
# write file with columns in the right order
data <- data[c("id", "iv.Group", "iv.set", "iv.order", "startdate", "submitdate", "valid.row", 
               "experiment.count", "lastpage", "Consent", "Tutorial", "Experience", "notation.experience",
               "Total.Time", "Concent.Time", "Tutorial.Time","Survey.Time", "Gender", "Age", "Degree", 
               "Role.count", "Role.R1", "Role.R2", "Role.R3", "Role.R4", "Role.R5", "Role.R6", 
               "Role.R7", "Role.R8", "Role.R9", "Role.R10", "Role.other", "Bias.count", "Bias.B1", 
               "Bias.B2", "Bias.B3", "Bias.B4", "Bias.B5", "Bias.B6", "Bias.B7", "Bias.B8", 
               "Bias.B9", "Bias.B10", "Bias.other", "IT", "Work", "Training", "Notation.count", 
               "Notation.None", "Notation.BPMN", "Notation.EPC", "Notation.UMLAD", "Notation.UML", 
               "Notation.CMMN", "Notation.other", "A.perceived", "A.Correct", "A.Time", 
               "A.Efficacy", "A.Efficiency", "iv.A.model", "iv.A.name", "iv.A.CC", "iv.A.CL", 
               "iv.A.CS", "iv.A.CAS", "iv.A.CS.SC", "iv.A.CS.SS", "iv.A.CS.SDS", "iv.A.CS.SPF",
               "iv.A.CS.DI", "iv.A.CS.PT", "iv.A.CS.PDT", "iv.A.CS.PE", "iv.A.CS.PM", "iv.A.CS.OC",
               "iv.A.CAS.DCP", "iv.A.CAS.DEP", "iv.A.CAS.DAC", "iv.A.CAS.DC", "iv.A.CAS.DE",
               "iv.A.CAS.DMA", "iv.A.CAS.DRN", "iv.A.CAS.DR", "iv.A.CAS.SE", "iv.A.CAS.SX",
               "iv.A.CAS.MH", "iv.A.CAS.MP", "iv.A.CAS.MC", "iv.A.CAS.MHB", "iv.A.CAS.MT",
               "B.perceived", "B.Correct", "B.Time", "B.Efficacy", 
               "B.Efficiency", "iv.B.model", "iv.B.name", "iv.B.CC", "iv.B.CL", "iv.B.CS", 
               "iv.B.CAS", "iv.B.CS.SC", "iv.B.CS.SS", "iv.B.CS.SDS", "iv.B.CS.SPF", "iv.B.CS.DI",
               "iv.B.CS.PT", "iv.B.CS.PDT", "iv.B.CS.PE", "iv.B.CS.PM", "iv.B.CS.OC", "iv.B.CAS.DCP",
               "iv.B.CAS.DEP", "iv.B.CAS.DAC", "iv.B.CAS.DC", "iv.B.CAS.DE", "iv.B.CAS.DMA",
               "iv.B.CAS.DRN", "iv.B.CAS.DR", "iv.B.CAS.SE", "iv.B.CAS.SX", "iv.B.CAS.MH",
               "iv.B.CAS.MP", "iv.B.CAS.MC", "iv.B.CAS.MHB", "iv.B.CAS.MT",
               "C.Compare", "iv.C.obs", "iv.C.calc", "iv.C.CC","iv.C.order3.CC","iv.C.order15.CC",
               "iv.C.CL","iv.C.order3.CL","iv.C.order15.CL","iv.C.CS","iv.C.order3.CS","iv.C.order15.CS",
               "iv.C.CAS","iv.C.order3.CAS","iv.C.order15.CAS", "Weights.count",
               "Weights.CasePlan", "Weights.Stage", "Weights.DStage",
               "Weights.PlanFrag", "Weights.CFileItem", "Weights.Task", "Weights.DTask", 
               "Weights.NBHTask", "Weights.ProcTask", "Weights.CaseTask", "Weights.CaseTasknim", 
               "Weights.BHTask", "Weights.Event", "Weights.UserEvent", "Weights.TimerEvent", 
               "Weights.Milestone", "Weights.Connector", "Weights.HumanIcon", 
               "Weights.CPlanningT", "Weights.EPlanningT", "Weights.AComplete", 
               "Weights.Collapsed", "Weights.Expanded", "Weights.ManualA", "Weights.Repetition",
               "Weights.Required", "Weights.EntryCritWC", "Weights.EntryCrit", 
               "Weights.ExitCritWC", "Weights.ExitCrit", "Weights.EntryCritAND", 
               "Weights.EntryCritOR", "Weights.ExitCritAND", "Weights.ExitCritOR", "Charity", 
               "Charity.other")]

# Let also sort the dataset
data <- data[order(data$id),]

write.csv(data,file = "dataset-all.csv",row.names=FALSE, na="")

# Remove data frames that are not needed anymore
rm(iv.map)
```

```{r other-files}

# Remove invalid variables from the dataset
write.csv(subset(data, select = c("id", "iv.Group", "iv.set", "iv.order", "startdate", "submitdate", "valid.row", 
               "experiment.count", "lastpage", "Consent", "Tutorial", "Experience", "notation.experience",
               "Total.Time", "Concent.Time", "Tutorial.Time","Survey.Time", "Gender", "Age", "Degree", 
               "Role.count", "Role.R1", "Role.R2", "Role.R3", "Role.R4", "Role.R5", "Role.R6", 
               "Role.R7", "Role.R8", "Role.R9", "Role.R10", "Role.other", "Bias.count", "Bias.B1", 
               "Bias.B2", "Bias.B3", "Bias.B4", "Bias.B5", "Bias.B6", "Bias.B7", "Bias.B8", 
               "Bias.B9", "Bias.B10", "Bias.other", "IT", "Work", "Training", "Notation.count", 
               "Notation.None", "Notation.BPMN", "Notation.EPC", "Notation.UMLAD", "Notation.UML", 
               "Notation.CMMN", "Notation.other", "A.perceived", "A.Correct", "A.Time", 
               "A.Efficacy", "A.Efficiency", "iv.A.model", "iv.A.name", "iv.A.CC", "iv.A.CL", 
               "iv.A.CS", "iv.A.CAS", "iv.A.CS.SC", "iv.A.CS.SS", "iv.A.CS.SDS", "iv.A.CS.SPF",
               "iv.A.CS.DI", "iv.A.CS.PT", "iv.A.CS.PDT", "iv.A.CS.PE", "iv.A.CS.PM", "iv.A.CS.OC",
               "iv.A.CAS.DCP", "iv.A.CAS.DEP", "iv.A.CAS.DAC", "iv.A.CAS.DC", "iv.A.CAS.DE",
               "iv.A.CAS.DMA", "iv.A.CAS.DRN", "iv.A.CAS.DR", "iv.A.CAS.SE", "iv.A.CAS.SX",
               "iv.A.CAS.MH", "iv.A.CAS.MP", "iv.A.CAS.MC", "iv.A.CAS.MHB", "iv.A.CAS.MT",
               "B.perceived", "B.Correct", "B.Time", "B.Efficacy", 
               "B.Efficiency", "iv.B.model", "iv.B.name", "iv.B.CC", "iv.B.CL", "iv.B.CS", 
               "iv.B.CAS", "iv.B.CS.SC", "iv.B.CS.SS", "iv.B.CS.SDS", "iv.B.CS.SPF", "iv.B.CS.DI",
               "iv.B.CS.PT", "iv.B.CS.PDT", "iv.B.CS.PE", "iv.B.CS.PM", "iv.B.CS.OC", "iv.B.CAS.DCP",
               "iv.B.CAS.DEP", "iv.B.CAS.DAC", "iv.B.CAS.DC", "iv.B.CAS.DE", "iv.B.CAS.DMA",
               "iv.B.CAS.DRN", "iv.B.CAS.DR", "iv.B.CAS.SE", "iv.B.CAS.SX", "iv.B.CAS.MH",
               "iv.B.CAS.MP", "iv.B.CAS.MC", "iv.B.CAS.MHB", "iv.B.CAS.MT",
               "C.Compare", "iv.C.obs", "iv.C.calc", "iv.C.CC","iv.C.order3.CC",
               "iv.C.order15.CC","iv.C.CL","iv.C.order3.CL","iv.C.order15.CL","iv.C.CS","iv.C.order3.CS",
               "iv.C.order15.CS","iv.C.CAS","iv.C.order3.CAS","iv.C.order15.CAS",
               "Weights.count", "Weights.CasePlan", "Weights.Stage", "Weights.DStage",
               "Weights.PlanFrag", "Weights.CFileItem", "Weights.Task", "Weights.DTask", 
               "Weights.NBHTask", "Weights.ProcTask", "Weights.CaseTask", "Weights.CaseTasknim", 
               "Weights.BHTask", "Weights.Event", "Weights.UserEvent", "Weights.TimerEvent", 
               "Weights.Milestone", "Weights.Connector", "Weights.HumanIcon", 
               "Weights.CPlanningT", "Weights.EPlanningT", "Weights.AComplete", 
               "Weights.Collapsed", "Weights.Expanded", "Weights.ManualA", "Weights.Repetition",
               "Weights.Required", "Weights.EntryCritWC", "Weights.EntryCrit", 
               "Weights.ExitCritWC", "Weights.ExitCrit", "Weights.EntryCritAND", 
               "Weights.EntryCritOR", "Weights.ExitCritAND", "Weights.ExitCritOR", "Charity", 
               "Charity.other")
               ,valid.row==1),
          file = "dataset-clean.csv",row.names=FALSE, na="")
```


Done.
