#
## Read the data-set (argument data.set.name) into data
#

# Just load the cvs file generated by CMMN-Convert-File.Rmd
data <- read.csv(data.set.name, header = TRUE, sep = ",", quote = "'\"", 
                 na.strings=c("", "\"\""), stringsAsFactors=FALSE)

# Load the weights 
ws <- read.csv(file.path(data.path,"in-weights-scaled-ordinal-rounded.csv"), header = TRUE, sep = ",", quote = "'\"", na.strings=c("", "\"\""),
               stringsAsFactors=FALSE)

# Load the original weights 
ws.original <- read.csv(file.path(data.path,"in-weights.csv"), header = TRUE, sep = ",", quote = "'\"", na.strings=c("", "\"\""),
               stringsAsFactors=FALSE)


# Load the independent variables
iv <- read.csv(file.path(data.path,"in-independent-variables.csv"), header = TRUE, sep = ",", quote = "'\"",
               na.strings=c("", "\"\""), stringsAsFactors=FALSE)


##Basic checkings
#If this fails, then we need to either fix the input files or fix this script. 
#This is just preemptive programming

# This whole block is checking we are dealing with the right input files
# This are the variable names that we expect in the data (LimeSurvey file)
data.names <- c("id", "iv.Group", "iv.set", "iv.order", "startdate", "submitdate", "valid.row", 
                "experiment.count", "lastpage", "Consent", "Tutorial", "Experience", "notation.experience",
                "Total.Time", "Concent.Time", "Tutorial.Time","Survey.Time", "Gender", "Age", "Degree", 
                "Role.count", "Role.R1", "Role.R2", "Role.R3", "Role.R4", "Role.R5", "Role.R6", 
                "Role.R7", "Role.R8", "Role.R9", "Role.R10", "Role.other", "Bias.count", "Bias.B1", 
                "Bias.B2", "Bias.B3", "Bias.B4", "Bias.B5", "Bias.B6", "Bias.B7", "Bias.B8", 
                "Bias.B9", "Bias.B10", "Bias.other", "IT", "Work", "Training", "Notation.count", 
                "Notation.None", "Notation.BPMN", "Notation.EPC", "Notation.UMLAD", "Notation.UML", 
                "Notation.CMMN", "Notation.other", "A.perceived", "A.Correct", "A.Time", 
                "A.Efficacy", "A.Efficiency", "iv.A.model", "iv.A.name", "iv.A.CC", "iv.A.CL", 
                "iv.A.CS", "iv.A.CAS", "iv.A.CS.SC", "iv.A.CS.SS", "iv.A.CS.SDS", "iv.A.CS.SPF",
                "iv.A.CS.DI", "iv.A.CS.PT", "iv.A.CS.PDT", "iv.A.CS.PE", "iv.A.CS.PM", "iv.A.CS.OC",
                "iv.A.CAS.DCP", "iv.A.CAS.DEP", "iv.A.CAS.DAC", "iv.A.CAS.DC", "iv.A.CAS.DE",
                "iv.A.CAS.DMA", "iv.A.CAS.DRN", "iv.A.CAS.DR", "iv.A.CAS.SE", "iv.A.CAS.SX",
                "iv.A.CAS.MH", "iv.A.CAS.MP", "iv.A.CAS.MC", "iv.A.CAS.MHB", "iv.A.CAS.MT",
                "B.perceived", "B.Correct", "B.Time", "B.Efficacy", 
                "B.Efficiency", "iv.B.model", "iv.B.name", "iv.B.CC", "iv.B.CL", "iv.B.CS", 
                "iv.B.CAS", "iv.B.CS.SC", "iv.B.CS.SS", "iv.B.CS.SDS", "iv.B.CS.SPF", "iv.B.CS.DI",
                "iv.B.CS.PT", "iv.B.CS.PDT", "iv.B.CS.PE", "iv.B.CS.PM", "iv.B.CS.OC", "iv.B.CAS.DCP",
                "iv.B.CAS.DEP", "iv.B.CAS.DAC", "iv.B.CAS.DC", "iv.B.CAS.DE", "iv.B.CAS.DMA",
                "iv.B.CAS.DRN", "iv.B.CAS.DR", "iv.B.CAS.SE", "iv.B.CAS.SX", "iv.B.CAS.MH",
                "iv.B.CAS.MP", "iv.B.CAS.MC", "iv.B.CAS.MHB", "iv.B.CAS.MT",
                "C.Compare", "iv.C.obs", "iv.C.calc", "iv.C.CC","iv.C.order3.CC",
                "iv.C.order15.CC","iv.C.CL","iv.C.order3.CL","iv.C.order15.CL","iv.C.CS","iv.C.order3.CS",
                "iv.C.order15.CS","iv.C.CAS","iv.C.order3.CAS","iv.C.order15.CAS",
                "Weights.count", "Weights.CasePlan", "Weights.Stage", "Weights.DStage",
                "Weights.PlanFrag", "Weights.CFileItem", "Weights.Task", "Weights.DTask", 
                "Weights.NBHTask", "Weights.ProcTask", "Weights.CaseTask", "Weights.CaseTasknim", 
                "Weights.BHTask", "Weights.Event", "Weights.UserEvent", "Weights.TimerEvent", 
                "Weights.Milestone", "Weights.Connector", "Weights.HumanIcon", 
                "Weights.CPlanningT", "Weights.EPlanningT", "Weights.AComplete", 
                "Weights.Collapsed", "Weights.Expanded", "Weights.ManualA", "Weights.Repetition",
                "Weights.Required", "Weights.EntryCritWC", "Weights.EntryCrit", 
                "Weights.ExitCritWC", "Weights.ExitCrit", "Weights.EntryCritAND", 
                "Weights.EntryCritOR", "Weights.ExitCritAND", "Weights.ExitCritOR", "Charity", 
                "Charity.other")


#Check we have the right variables
if(!identical(sort(na.omit(data.names)),sort(na.omit(names(data)))))
{
  stop(paste0("data:[",data.names,"] = [", names(data),"]"))
  #knit_exit()
}
